[{"uri":"/CSBlog/index.html","title":"CSBlog\r\n","content":"# CSBlog\r\n\r\n![CSB](img/CSB.png)\r\n\r\nWelcome to the CSBlog.\r\nThis is the place where members of the department of Computational Systems Biology of the TU Kaiserslautern blog about their work,\r\nresearch, and other loosely related stuff.\r\n\r\nFor more information about our research and our group in general, head to our [website](https://csb.bio.uni-kl.de/).\r\nIf you want to take a look at our projects, head over to our [github page](https://github.com/CSBiology)\r\n\r\nBlogPosts are accessible on the sidebar."},{"uri":"/CSBlog/posts/0_how2JSONSchema.html","title":"How to develop and use a JSON Schema","content":"(**\n\n---\ntitle: How to develop and use a JSON Schema\ncategory: Implementation\ncategoryindex: 3\nindex: 0\n---\n\n# How to develop and use a JSON Schema\n_[Oliver Maus](https://github.com/omaus)_\n\n## Content\n- [What are JSON Schemas?](#What-are-JSON-Schemas)\n- [JSON syntax](#JSON-syntax)\n- [The basic structure of a JSON Schema](#The-basic-structure-of-a-JSON-Schema)\n- [References](#References)\n- [Validation of JSON files by a Schema](#Validation-of-JSON-files-by-a-Schema)\n- [Further reading](#Further-reading)\n\n## What are JSON Schemas?\n\nJSON (JavaScript Object Notation) is a common data format for storing data and metadata and widely used for data exchange purposes. It is easily human- as well as machine-readable.  \nWhile JSON files and formats can be written in a simple and non-standardized way (as long as the syntax is respected), standardizing a specific JSON format might be useful when considering validation, documentation, and interaction control.\n\nJSON Schemas are data models that are build out of JSON syntax themselves.\n\n## JSON syntax\n\nSince the syntax of JSON is very simple and easy to understand, here\u0027s everything to know:  \n\n- A JSON file consists of at least one empty object\n- Objects are opened with \u0060{\u0060 and closed with \u0060}\u0060\n- Objects consist of key/value (aka name/value) pairs. Keys (or names) are identifiers realized as strings, values are corresponding information realized via primitive data types, both are separated via the character \u0060:\u0060\n- There are 6 basic primitive data types:\n  - null: no value (\u0060null\u0060)\n  - boolean: \u0060true\u0060 or \u0060false\u0060 value\n  - number: decimal number value, e.g. \u00607\u0060 or \u00601.337\u0060\n  - string: unicode text value, e.g. \u0060\u0022Hello World!\u0022\u0060\n  - object: unordered set of properties, consists of key/value pairs, e.g. \u0060{ \u0022name\u0022: \u0022Max Mustermann\u0022, \u0022age\u0022: 44 }\u0060\n  - array: ordered list of instances, consists of values, e.g. \u0060[ \u0022Hello \u0022, \u0022World!\u0022 ]\u0060\n- As seen above, \u0060,\u0060 is used to separate different key/value pairs in objects and instances in arrays\n- Objects can be nested infinitely\n- Scoping is similar to F#, both \u0060[ \u0022Hello \u0022, \u0022World!\u0022 ]\u0060 as well as  \n![image](https://user-images.githubusercontent.com/47781170/131900223-3fa36d2f-d65a-44ce-9913-69a2f42b35f2.png)  \n  is possible\n\n## The basic structure of a JSON Schema\n\nSince JSON Schemas are JSON files in a sense, they are written very similarly.  \nLet\u0027s develop a JSON schema for \u2012 say \u2013 future blogposts. It should consist of an identifier, a title, a category to which it belongs, a value if it is already uploaded or not, and an array of tags.  \nA finished JSON file following this schema should therefore look like this:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022identifier\u0022: 0,\n  \u0022title\u0022: \u0022How to develop and use a JSON Schema\u0022,\n  \u0022category\u0022: \u0022Implementation\u0022,\n  \u0022uploaded\u0022: true,\n  \u0022tags\u0022: [ \u0022implementation\u0022, \u0022JSON\u0022, \u0022standardization\u0022 ]\n}\n\u0060\u0060\u0060\n\nJSON Schemas must start with 2 unique key/value pairs that are referencing them as specific JSON Schemas:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022,\n}\n\u0060\u0060\u0060\n\nThe first key, \u0060\u0022$schema\u0022\u0060 references a JSON Schema to a so-called Metaschema, here of the ID \u0022https://json-schema.org/draft/2020-12/schema\u0022.  \nThe value of second key, \u0060\u0022$id\u0022\u0060, is a unique identifier for this JSON Schema, typically in the form of a URI.  \nThe \u0060$\u0060 is a special character and marks Schema-related keywords.\n\nThere\u0027s more to add: Our JSON Schema needs a title and a description:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022,\n  \u0022title\u0022: \u0022Blogpost entry\u0022,\n  \u0022description\u0022: \u0022An entry of our blogpost series, consisting of an identifier, a title, a category, the upload status, and some tags.\u0022,\n}\n\u0060\u0060\u0060\n\nThese are called \u0022Schema Annotations\u0022 since they annotate our Schema and provide some information about it.\nThe last thing to add is a so-called \u0022Validation keyword\u0022:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022,\n  \u0022title\u0022: \u0022Blogpost entry\u0022,\n  \u0022description\u0022: \u0022An entry of our blogpost series, consisting of an identifier, a title, a category, the upload status, and some tags.\u0022,\n  \u0022type\u0022: \u0022object\u0022\n}\n\u0060\u0060\u0060\n\nThe JSON files of our Schema must have a type. In our case, it\u0027s an object but the primitive data types as well as \u0060integer\u0060 (a \u0060number\u0060 without fractional parts) are also applicable. We will examine that later.\nThere are a lot of other Schema Keywords, Schema Annotations and Validation Keywords. We will see some of them later but there are also some that are not important now and can be looked at later if required.\n\nNow, since we wrote the \u0022metadata\u0022 of our JSON Schema, we want to add the properties of our blogpost JSON file seen above:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022,\n  \u0022title\u0022: \u0022Blogpost entry\u0022,\n  \u0022description\u0022: \u0022An entry of our blogpost series, consisting of an identifier, a title, a category, the upload status, and some tags.\u0022,\n  \u0022type\u0022: \u0022object\u0022,\n  \u0022properties\u0022: {\n    \u0022identifier\u0022: {\n      \u0022description\u0022: \u0022The identifier of a blogpost entry, an integer.\u0022,\n      \u0022type\u0022: \u0022integer\u0022\n    },\n    \u0022title\u0022: {\n      \u0022description\u0022: \u0022The title of a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022category\u0022: {\n      \u0022description\u0022: \u0022The category a blogpost entry belongs to.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022uploaded\u0022: {\n      \u0022description\u0022: \u0022A value that tells if a blogpost entry has been already uploaded to a repository or not.\u0022,\n      \u0022type\u0022: \u0022boolean\u0022\n    },\n    \u0022tags\u0022: {\n        \u0022description\u0022: \u0022A list of tags that help describing and categorizing a blogpost entry.\u0022,\n        \u0022type\u0022: \u0022array\u0022,\n        \u0022items\u0022: {\n          \u0022type\u0022: \u0022string\u0022\n        },\n        \u0022uniqueItems\u0022: true\n    }\n  },\n  \u0022required\u0022:  [ \u0022identifier\u0022, \u0022title\u0022, \u0022category\u0022 ]\n}\n\u0060\u0060\u0060\n\n\u0060\u0022properties\u0022\u0060 is an object consisting of objects. The properties set in our original JSON file are realized here. As for the \u0060\u0022tags\u0022\u0060 property, we define that the tags must be different.  \nThere\u0027s another Validation Keyword we added here: The \u0060\u0022required\u0022\u0060 key. It is an array consisting of all the properties we think are mandatory for the JSON file to be valid. In our case, we think that the tags and the upload status should rather be optional information and thus are not added to the required list.\n\nSince we are dealing with this JSON file and its Schema right now we are realizing that an author is missing! \uD83D\uDE31\n\n\u0060\u0060\u0060javascript\n{\n  \u0022identifier\u0022: 0,\n  \u0022title\u0022: \u0022How to develop and use a JSON Schema\u0022,\n  \u0022category\u0022: \u0022Implementation\u0022,\n  \u0022uploaded\u0022: true,\n  \u0022tags\u0022: [ \u0022implementation\u0022, \u0022JSON\u0022, \u0022standardization\u0022 ],\n  \u0022authors\u0022: [\n    {\n      \u0022name\u0022: \u0022Oliver Maus\u0022,\n      \u0022organization\u0022: \u0022CSBiology\u0022\n    }\n  ]\n}\n\u0060\u0060\u0060\n\nThere\u0027s something new: We now must add a nested type to our Schema:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022,\n  \u0022title\u0022: \u0022Blogpost entry\u0022,\n  \u0022description\u0022: \u0022An entry of our blogpost series, consisting of an identifier, a title, a category, the upload status, and some tags.\u0022,\n  \u0022type\u0022: \u0022object\u0022,\n  \u0022properties\u0022: {\n    \u0022identifier\u0022: {\n      \u0022description\u0022: \u0022The identifier of a blogpost entry, an integer.\u0022,\n      \u0022type\u0022: \u0022integer\u0022\n    },\n    \u0022title\u0022: {\n      \u0022description\u0022: \u0022The title of a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022category\u0022: {\n      \u0022description\u0022: \u0022The category a blogpost entry belongs to.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022uploaded\u0022: {\n      \u0022description\u0022: \u0022A value that tells if a blogpost entry has been already uploaded to a repository or not.\u0022,\n      \u0022type\u0022: \u0022boolean\u0022\n    },\n    \u0022tags\u0022: {\n      \u0022description\u0022: \u0022A list of tags that help describing and categorizing a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022array\u0022,\n      \u0022items\u0022: {\n        \u0022type\u0022: \u0022string\u0022\n      },\n      \u0022uniqueItems\u0022: true\n    },\n    \u0022authors\u0022: {\n      \u0022description\u0022: \u0022A list of all authors associated with a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022array\u0022,\n      \u0022items\u0022: {\n        \u0022type\u0022: \u0022object\u0022,\n        \u0022properties\u0022: {\n          \u0022name\u0022: {\n            \u0022type\u0022: \u0022string\u0022\n          },\n          \u0022organization\u0022: {\n            \u0022type\u0022: \u0022string\u0022\n          }\n        }\n      },\n      \u0022minItems\u0022: 1,\n      \u0022uniqueItems\u0022: true\n    }\n  },\n  \u0022required\u0022:  [ \u0022identifier\u0022, \u0022title\u0022, \u0022category\u0022, \u0022authors\u0022 ]\n}\n\u0060\u0060\u0060\n\nWe show our Schema to our boss but unfortunately he\u0027s not satisfied. He reckons that there should be a license associated with it.\n\n## References\n\nThere\u0027s already a JSON Schema for licenses. So we want to incorporate it into ours.\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/license.schema.json\u0022,\n  \u0022title\u0022: \u0022Copyright license\u0022,\n  \u0022description\u0022: \u0022A license regarding copyright\u0022,\n  \u0022type\u0022: \u0022object\u0022,\n  \u0022properties\u0022: {\n    \u0022name\u0022: {\n      \u0022description\u0022: \u0022The name of the license\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022version\u0022: {\n      \u0022description\u0022: \u0022The version of this license in the form of \u0027v(Major).(Minor).(Patch)\u0027.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022author\u0022: {\n      \u0022description\u0022: \u0022The name of the author of a license.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022date\u0022: {\n      \u0022description\u0022: \u0022The exact date when a license was published.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    }\n  },\n  \u0022required\u0022: [ \u0022name\u0022, \u0022version\u0022, \u0022author\u0022, \u0022date\u0022 ]\n}\n\u0060\u0060\u0060\n\nOur new Blogpost Schema:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022$schema\u0022: \u0022https://json-schema.org/draft/2020-12/schema\u0022,\n  \u0022$id\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022,\n  \u0022title\u0022: \u0022Blogpost entry\u0022,\n  \u0022description\u0022: \u0022An entry of our blogpost series, consisting of an identifier, a title, a category, the upload status, and some tags.\u0022,\n  \u0022type\u0022: \u0022object\u0022,\n  \u0022properties\u0022: {\n    \u0022identifier\u0022: {\n      \u0022description\u0022: \u0022The identifier of a blogpost entry, an integer.\u0022,\n      \u0022type\u0022: \u0022integer\u0022\n    },\n    \u0022title\u0022: {\n      \u0022description\u0022: \u0022The title of a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022category\u0022: {\n      \u0022description\u0022: \u0022The category a blogpost entry belongs to.\u0022,\n      \u0022type\u0022: \u0022string\u0022\n    },\n    \u0022uploaded\u0022: {\n      \u0022description\u0022: \u0022A value that tells if a blogpost entry has been already uploaded to a repository or not.\u0022,\n      \u0022type\u0022: \u0022boolean\u0022\n    },\n    \u0022tags\u0022: {\n      \u0022description\u0022: \u0022A list of tags that help describing and categorizing a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022array\u0022,\n      \u0022items\u0022: {\n        \u0022type\u0022: \u0022string\u0022\n      },\n      \u0022uniqueItems\u0022: true\n    },\n    \u0022authors\u0022: {\n      \u0022description\u0022: \u0022A list of all authors associated with a blogpost entry.\u0022,\n      \u0022type\u0022: \u0022array\u0022,\n      \u0022items\u0022: {\n        \u0022type\u0022: \u0022object\u0022,\n        \u0022properties\u0022: {\n          \u0022name\u0022: {\n            \u0022type\u0022: \u0022string\u0022\n          },\n          \u0022organization\u0022: {\n            \u0022type\u0022: \u0022string\u0022\n          }\n        }\n      },\n      \u0022minItems\u0022: 1,\n      \u0022uniqueItems\u0022: true\n    },\n    \u0022license\u0022: {\n      \u0022description\u0022: \u0022The license used for a blogpost entry.\u0022,\n      \u0022$ref\u0022: \u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/license.schema.json\u0022\n    }\n  },\n  \u0022required\u0022:  [ \u0022identifier\u0022, \u0022title\u0022, \u0022category\u0022, \u0022authors\u0022, \u0022license\u0022 ]\n}\n\u0060\u0060\u0060\n\nLet\u0027s look at the finished JSON file for this blogpost:\n\n\u0060\u0060\u0060javascript\n{\n  \u0022identifier\u0022: 0,\n  \u0022title\u0022: \u0022How to develop and use a JSON Schema\u0022,\n  \u0022category\u0022: \u0022Implementation\u0022,\n  \u0022uploaded\u0022: true,\n  \u0022tags\u0022: [ \u0022implementation\u0022, \u0022JSON\u0022, \u0022standardization\u0022 ],\n  \u0022authors\u0022: [\n    {\n      \u0022name\u0022: \u0022Oliver Maus\u0022,\n      \u0022organization\u0022: \u0022CSBiology\u0022\n    }\n  ],\n  \u0022license\u0022: {\n    \u0022name\u0022: \u0022Creative Commons Attribution 4.0 International Public License\u0022,\n    \u0022version\u0022: \u0022v4.0.0\u0022,\n    \u0022author\u0022: null,\n    \u0022date\u0022: null\n  }\n}\n\u0060\u0060\u0060\n\n## Validation of JSON files by a Schema\n\nThe Newtonsoft.Json library provides great JSON Schema support regarding validating your JSON files by a given Schema.\n\n*)\n\n(***hide***)\n\n#nowarn \u00220064\u0022\n\n(******)\n\n#r \u0022nuget: FSharp.Data\u0022\n#r \u0022nuget: Newtonsoft.Json\u0022\n#r \u0022nuget: Newtonsoft.Json.Schema\u0022\n\nopen FSharp.Data\nopen Newtonsoft.Json.Linq\nopen Newtonsoft.Json.Schema\n\n// We download the Json strings via FSharp.Data and parse them into a JSchema or JObject, respectively.\nlet licenseSchema = Http.RequestString @\u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/license.schema.json\u0022 |\u003E JSchema.Parse\nlet ccLicense = Http.RequestString @\u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/CCAtt4IPL.json\u0022 |\u003E JObject.Parse\n\n// We match the outcome of the IsValid method to get error messages, if available.\nmatch (ccLicense.IsValid(licenseSchema)) : (bool * #seq\u003Cstring\u003E) with\n| (false,msg) -\u003E printfn \u0022not valid due to: %A\u0022 msg\n| _ -\u003E printfn \u0022valid\u0022\n(*** include-output ***)\n\n(**\n\nOh no, our file seems to be invalid.  \nWhen giving it a closer look, we see that the required properties \u0022author\u0022 and \u0022date\u0022 are set to null. Thus, we replace them with empty strings and start anew.\n\n*)\n\nlet ccLicenseNew = Http.RequestString @\u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/CCAtt4IPL_new.json\u0022 |\u003E JObject.Parse\n\nmatch (ccLicenseNew.IsValid(licenseSchema)) : (bool * #seq\u003Cstring\u003E) with\n| (false,msg) -\u003E printfn \u0022not valid due to: %A\u0022 msg\n| _ -\u003E printfn \u0022valid\u0022\n(*** include-output ***)\n\n(**\n\nLet\u0027s now test this with our blogpost Schema and the corresponding JSON file.  \nSince this Schema references another one, we need a resolver:\n\n*)\n\nlet resolver = JSchemaUrlResolver()\n\nlet blogpostSchema = JSchema.Parse(Http.RequestString @\u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost.schema.json\u0022, resolver)\nlet blogpost0 = Http.RequestString @\u0022https://raw.githubusercontent.com/omaus/CSBlogpost/main/blogpost0.json\u0022 |\u003E JObject.Parse\n\nmatch (blogpost0.IsValid(blogpostSchema)) : (bool * #seq\u003Cstring\u003E) with\n| (false,msg) -\u003E printfn \u0022not valid due to: %A\u0022 msg\n| _ -\u003E printfn \u0022valid\u0022\n(*** include-output ***)\n\n(**\n\n## Further reading\n\n- [Understanding JSON](https://json-schema.org/understanding-json-schema/index.html)\n- [Official JSON Schema Homepage](https://json-schema.org/)\n- [Schema Core Specification](https://json-schema.org/draft/2020-12/json-schema-core.html)\n- [Schema Validation Specification](https://json-schema.org/draft/2020-12/json-schema-validation.html)\n- [Relative JSON pointers Specification](https://json-schema.org/draft/2020-12/relative-json-pointer.html)\n\n*)"},{"uri":"/CSBlog/posts/1_how2Fable.html","title":"How to use Fable","content":"---\r\ntitle: How to use Fable\r\ncategory: Implementation\r\ncategoryindex: 3\r\nindex: 1\r\n---\r\n\r\n# What is Fable and how to use it\r\n_[Kevin Frey](https://github.com/Freymaurer)_\r\n\r\n## Content\r\n- [What is Fable?](#What-is-Fable)\r\n- [Fable Example](#Fable-Example)\r\n    - [Fable Template](#Fable-Template)\r\n    - [Fable REPL code](#Fable-REPL-code)\r\n- [F# to JS](#FSharp-to-JS)\r\n- [JS in F#](#JS-in-F#)\r\n    - [Dynamic casting](#Dynamic-casting)\r\n    - [Setting up an interface](#Setting-up-an-interface)\r\n    - [Typesafety?](#Typesafety)\r\n- [Further reading](#Further-reading)\r\n\r\n## What is Fable\r\n\r\n\u003E Fable is a compiler that lets you use F# to build applications that run in the JavaScript ecosystem.\r\n\r\nWhat does this exactly mean?\r\n\r\nYou can write F# code and let fable translate it to javascript. (The following window shows [Fable REPL](https://fable.io/repl/) and in-browser tool live translating F# code to javascript.)\r\n\r\n\u003Cbr\u003E\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EClick to show Fable REPL\u003C/summary\u003E\r\n\r\n\u003Ciframe height=\u0022600px\u0022 width=\u0022100%\u0022 src=\u0022https://fable.io/repl/#?code=LYewJgrgNgpgBAFRBATgOgKoDsCWIsDOAsAFCkD05cAYiiMHABYAuzADgQFyVggDGBNMBx86BEADNmaPvXIwsAWggFyvZlhjNyEgowCGKNuWbIUFKgDUcBHMzjNG8KDiwBrOPoBGIAG7wJEBQ4UBR4V0CUYH1mPCw4fDgYfT5GBxA2EQs4AE1kOD59eP0ocTgJVzAQoOdklFwsAHM4MPFUPhgCT3sWdi5KXQMjNCDG8lJSDIU4AGUATwJmGGAJklBIWDgAERtRHGEsGJgwbDiugF5VuGu4SioEJ3KQKCgQAHdXZrC2VoVmLsc8AIEDsCQknjgbCg\u002BjmnwKhjAaFINwcczY8BmIPslxIKJRAB84AAJOr-ZF466EgDCUAgXmIuIpcEJO30oCwYAZTOZszY\u002BjAnSuNzucAAgttdih9q4jlVTolCsVSiA4F54CpjukWjAfp0-g5Higih5JBCoTC4YUUIjyddmGj4AAlY1wHHckWOnW-LD-A3wI3uMHw61dABMcDQaDgAEYAAy2vGEywlCDwU2uZgJglijpZm6EgDSnzzlLgAEVUwoSzyAFIpNxCikinYEPYHWVweWEeFKsr7KHLfUgLwAKxgfGYiiCOD\u002BmuAyzVKEE1cWMREIQXMGCAHEtKKXs73AQABQASld1ZRAG04LCYFAqqLc4zuSjInAcB-4uHIzHY3BeFvGcHzgZNaXCS88TvEC6z4BsX1fa5oKqCsYCrBDEOQuAiyaOAAF1G1uShEEYGwPy6fRtVka1UXRA0YgKegvFcToIUxUEiiqSjDzcJEEJFABJZgAHIulkYB2S1DVVRARw4E9ajOU8DkJVbKV2yWOVcHwLo3iceJvm9WJcLAGJ9D4lF7ToqkEVdOAAG9ZixTgnLsABueTjRcni4AAX0IkUHjI8S2AgJYKLgFxFm1XUCD\u002BOESigP1gyU1xkoFOCLJuWB7AkaAoC2ccPDdJkr0Jd9gVBNKbxJQx-g81l2U5DyaTpAgPJmPkBQIPCAJASC3yCFoXTSni0F3Zh9ygHiT3PXgBqZLDHPY5hzkq5gPJ484Aw8XzmQIsh\u002BOIoKuhgAAPNkB0YrB-BQX1KOEmzrWEhJR3HexTAhRYpSaLLrhyuA9HeAAFaFYSaJ6qmPPgXMh88SopAGdpmZgfuaBHX2iZhUgKNAfI\u002BRwFsJJ94EUAA\u002BOAACIScponsLhcmqZwxpaYwplCVQ6ZGcpzmsFZxDS1gjxuaF-mBaTFN4HiRnvrhLBqwB9aUbRi82YpLGcb4NAVrgAnGDp1r6Tgbm\u002BFpekxcQlkcDZfAlO5sBraaggLdfQlOv5VjuYILrOhd7lCVqu6um5pw6ud6tkdRuE4AAaipoNKdjwGsWV4tDpRQLSNOi7gCun4Mwol5kqtVLikhMG4Qy3iEwB-OfSmyHZtV7l3xLr9ynywq4L6ha6\u002BYCR4kpgBSZ24GPIG3lBi0IdskvT0IgGwCNN4AHlNFFDlgZ\u002B5hIbPZumSRzi7M0N5ZgWJZgDxzj6DPas8peLveKvANEQAOXO5hj3vgqirQAAZBQjRHCnl6tWfEFNx6MBBhXGeNEyYUz7gPKmI9Kbz0OgmJe\u002BhV7r03tvXeaCUSYOwTADeYAt4ZnwRg5ea8SG4IoQiW\u002B6DDpAA\u0026html=DwCwLgtgNgfAsAKAAQqaApgQwCb2ag4CdMTJcMABwFp0BHAVwEsA3AXgCIBhAewDsw6AdQAqAT0roOSAMb9BAzoIAeYAPThoAbhkhMAJwDOJNgzAAzagA4OeQhqy5EhAEY9sYu6mBq3HvD6asEA\u0026css=Q\u0022\u003E\u003C/iframe\u003E\r\n\r\n\u003C/details\u003E\r\n\r\n\u003Cbr\u003E\r\n\r\nTarget runtime is JavaScript! _All code execution will be done on a JavaScript level_. Fable output can only be executed in the Browser.\r\n\r\n## Fable Example\r\n\r\nThe Fable application with the final code can be found in the root directory of the [CSBlog](https://github.com/CSBiology/CSBlog) repository.\r\n\r\n- Download \u0060How2Fable.zip\u0060 (if you download the whole repo, you will need to move the zip out of it, or it will lead to depedency issues and it will not run)\r\n- Unzip it \r\n- Open powershell/commandline in the unzipped \u0060How2Fable\u0060 folder.\r\n- \u0060npm install\u0060\r\n- \u0060npm start\u0060\r\n- open browser at \u0060localhost:8080\u0060\r\n\r\nAll further examples are based on the standard Fable template, which you can install as described [here](https://fable.io/docs/2-steps/your-first-fable-project.html).\r\n\r\n### Fable Template\r\n\r\nShort summary:\r\n\r\n- \u0060dotnet new --install Fable.Template\u0060 \u0026#10142; install newest Fable template.\r\n- \u0060dotnet new fable\u0060 \u0026#10142; create new Fable template in open folder.\r\n- \u0060npm install\u0060 \u0026#10142; install all JS dependencies.\r\n- \u0060npm start\u0060 \u0026#10142; install all .NET dependencies and start local webpack server with fable output.\r\n\r\nYou can find the example project in the CSBlogpost repository (*How2Fable*-Folder).\r\n\r\nFirst to the important elements in the fable folder:\r\n\r\n- \u0060package.json\u0060\r\n    - \u0060scripts\u0060 defines for example \u0060npm start\u0060 as \u0060dotnet fable watch src --run webpack-dev-server\u0060\r\n    -  \u0060devDependencies\u0060 reference of all JS dependencies.\r\n- \u0060webpack.config.js\u0060 all settings for webapplication. For exmaple, determines localhost port.\r\n- \u0060public\\index.html\u0060 the base [html](https://www.w3schools.com/html/default.asp) page displayed in browser.\r\n- \u0060public\\bundle.js\u0060 all Fable output bundled together.\r\n- \u0060src\u0060, this folder contains the F# project, which will be compiled to JS.\r\n    - Can use [paket](https://fsprojects.github.io/Paket/) or nuget references in \u0060\u0060.fsproj\u0060\u0060 file for dependencies.\r\n    - Can consist of multiple \u0060\u0060.fs\u0060\u0060 files.\r\n\r\n### Fable REPL code\r\n\r\nIn the next step I added the code from the Fable REPL above to the Fable template project and adjusted the button for it.\r\nThis will result in a button (which can be found in the \u0060\u0060index.html\u0060\u0060), which displays on-click one drawn card.\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003Eindex.html code\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060html\r\n\u003C!--index.html--\u003E\r\n\u003Cbody\u003E\r\n    \u003Cp\u003EFable is running\u003C/p\u003E\r\n    \u003Cp\u003EYou can click on this button:\u003C/p\u003E\r\n    \u003C!--This is our button--\u003E\r\n    \u003Cbutton class=\u0022my-button\u0022\u003EClick me\u003C/button\u003E\r\n    \u003Cscript src=\u0022bundle.js\u0022\u003E\u003C/script\u003E\r\n\u003C/body\u003E\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EApp.fs code\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// App.fs\r\n/// \r\nmodule Cards =\r\n\r\n    /// The following represents the suit of a playing card.\r\n    type Suit =\r\n        | Hearts\r\n        | Clubs\r\n        | Diamonds\r\n        | Spades\r\n\r\n    /// A Discriminated Union can also be used to represent the rank of a playing card.\r\n    type Rank =\r\n        /// Represents the rank of cards 2 .. 10\r\n        | Value of int\r\n        | Ace\r\n        | King\r\n        | Queen\r\n        | Jack\r\n\r\n        /// Discriminated Unions can also implement object-oriented members.\r\n        static member GetAllRanks() =\r\n            [ yield Ace\r\n              for i in 2 .. 10 do yield Value i\r\n              yield Jack\r\n              yield Queen\r\n              yield King ]\r\n\r\n    /// This is a record type that combines a Suit and a Rank.\r\n    /// It\u0027s common to use both Records and Discriminated Unions when representing data.\r\n    type Card = { Suit: Suit; Rank: Rank }\r\n\r\n    /// This computes a list representing all the cards in the deck.\r\n    let fullDeck =\r\n        [| for suit in [ Hearts; Diamonds; Clubs; Spades] do\r\n              for rank in Rank.GetAllRanks() do\r\n                  yield { Suit=suit; Rank=rank } |]\r\n\r\n    /// This example converts a \u0027Card\u0027 object to a string.\r\n    let showPlayingCard (c: Card) =\r\n        let rankString =\r\n            match c.Rank with\r\n            | Ace -\u003E \u0022Ace\u0022\r\n            | King -\u003E \u0022King\u0022\r\n            | Queen -\u003E \u0022Queen\u0022\r\n            | Jack -\u003E \u0022Jack\u0022\r\n            | Value n -\u003E string n\r\n        let suitString =\r\n            match c.Suit with\r\n            | Clubs -\u003E \u0022clubs\u0022\r\n            | Diamonds -\u003E \u0022diamonds\u0022\r\n            | Spades -\u003E \u0022spades\u0022\r\n            | Hearts -\u003E \u0022hearts\u0022\r\n        rankString  \u002B \u0022 of \u0022 \u002B suitString\r\n\r\n    /// This example prints all the cards in a playing deck.\r\n    let printAllCards() =\r\n        for card in fullDeck do\r\n            printfn \u0022%s\u0022 (showPlayingCard card)\r\n\r\n    let drawOneAndPrintCard() =\r\n        let rand = new System.Random()\r\n        fullDeck.[rand.Next(fullDeck.Length)] \r\n        |\u003E (showPlayingCard)\r\n\r\n// Mutable variable to count the number of times we clicked the button\r\nlet mutable drawnCard = \u0022\u0022\r\n\r\n// Get a reference to our button (in file: index.html) and cast the Element to an HTMLButtonElement.\r\n/// The last step is necessary as the compiler does otherwise not understand which type the html element has.\r\nlet myButton = document.querySelector(\u0022.my-button\u0022) :?\u003E Browser.Types.HTMLButtonElement\r\n\r\n// Register our listener\r\nmyButton.onclick \u003C- fun _ -\u003E\r\n    drawnCard \u003C- Cards.drawOneAndPrintCard()\r\n    myButton.innerText \u003C- sprintf \u0022You pulled: %s \u0022 drawnCard\r\n\u0060\u0060\u0060\r\n\r\n\u003C/details\u003E\r\n\r\nThe example will at this point, and after clicking the button, look like this:\r\n\r\n![Image of Fable with the code implemented](../img/How2Fable_example1.png)\r\n\r\n## FSharp to JS\r\n\r\nHow can Fable translate our F# code to JS? Because most functions of the core F# libraries were redone in JS and Fable downloads these functions to \u0060\u0060src\\.fable\u0060\u0060.\r\nThese are then used to compile the F# source files into their JS counterparts. After \u0060\u0060npm start\u0060\u0060, Fable will create \u0060\u0060.fs.js\u0060\u0060 (default) files from all F# source files.\r\nFor example \u0060\u0060App.fs\u0060\u0060  \u0026#10142; \u0060\u0060App.fs.js\u0060\u0060. If we look into these, we can see that the modules are imported from the \u0060\u0060.fable\u0060\u0060 folder and used to translate our code.\r\nThis translated code will be used for the webpack app.\r\n\r\nTo further showcase this, I created a new source file \u0060SearchMe.fs\u0060 with just one binding and call this binding from the App.fs file.\r\nThis is necessary, as \u0060App.fs\u0060 is defined as our app entry in the \u0060webpack.config.js\u0060 and Fable will only compile referenced F# code to JS, to minimize bloat.\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// SearchMe.fs\r\n///\r\nmodule SearchMe\r\n\r\nlet iAmAVeryLongAndEasilySearchableName = \u0022Hello World\u0022\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// App.fs\r\n///\r\nprintfn $\u0022{SearchMe.iAmAVeryLongAndEasilySearchableName}\u0022\r\n\u0060\u0060\u0060\r\n\r\n\u0060npm run build\u0060 will bundle all Fable-compiled JS files into \u0060public\\bundle.js\u0060. This file will contain imports from \u0060./src/.fable/\u0060, \r\nbut also one for each F# source file. If we search it for \u0060iAmAVeryLongAndEasilySearchableName\u0060 or \u0060drawOneAndPrintCard\u0060 we will find the respective JS code.\r\n\r\n\u003Cbr\u003E\r\n\r\nBecause Fable can only compile code patterns and the functions from the modules in \u0060\u0060src\\.fable\u0060\u0060 it is **not** possible to compile any F# library with Fable out of the box.\r\n\r\nIf we add \u0060\u003CPackageReference Include=\u0022FSharp.Stats\u0022 Version=\u00220.4.3\u0022 /\u003E\u0060 to \u0060App.fsproj\u0060 it will return an error.\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// App.fs\r\n///\r\nopen FSharp.Stats\r\n\r\n// Example from https://fslab.org/FSharp.Stats/BasicStats.html\r\nlet mean1 = \r\n    [10; 2; 19; 24; 6; 23; 47; 24; 54; 77;]\r\n    |\u003E Seq.meanBy float\r\n\r\nprintfn $\u0022{mean1}\u0022\r\n\u0060\u0060\u0060\r\n\r\nError in powershell/cmd.\r\n\u0060\u0060\u0060powershell\r\nF# compilation finished in 59ms\r\nC:/Users/User/source/repos/How2Fable/src/App.fs(70,13): (70,18) error FSHARP: The namespace \u0027Stats\u0027 is not defined. (code 39)\r\nC:/Users/User/source/repos/How2Fable/src/App.fs(74,12): (74,18) error FSHARP: The value, constructor, namespace or type \u0027meanBy\u0027 is not defined. Maybe you want one of the following:\r\n   maxBy\r\n   minBy\r\n   maxBy\r\n   minBy (code 39)\r\nWatching src\r\n\u0060\u0060\u0060\r\n\r\nFable has no idea about the \u0060Seq.meanBy\u0060 function and cannot translate it to JS. For a list of Fable compatible libraries you can look \r\n[here](https://fable.io/docs/dotnet/compatibility.html) for F# Core libraries and [here](https://fable.io/resources.html#Libraries) for community ressources.\r\n\r\nIt is also **possible to make F# libraries Fable compatible** as described [here](https://fable.io/docs/your-fable-project/author-a-fable-library.html). \r\nThis was for example done for the [ISADotNet library](https://github.com/nfdi4plants/ISADotNet/blob/developer/src/ISADotnet/ISADotNet.fsproj#L65) with a \r\nconditional trigger, to publish two nuget package versions. One with and one without Fable compatibility.\r\n\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EApp.fsproj code\u003C/summary\u003E\r\n\u0060\u0060\u0060xml\r\n\u003C!--App.fsproj--\u003E\r\n\u003CItemGroup Condition=\u0022 \u0027$(PackageId)\u0027 == \u0027ISADotNet.Fable\u0027 \u0022\u003E\r\n  \u003CContent Include=\u0022*.fsproj; **\\*.fs; **\\*.fsi\u0022 PackagePath=\u0022fable\\\u0022 /\u003E\r\n\u003C/ItemGroup\u003E\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003Ebuild.fsx code\u003C/summary\u003E\r\n\r\nThis code is a modified version of the build target from the [libary development knowledgebase article](https://github.com/CSBiology/KnowledgeBase/blob/main/knowledgebase/devops/library-development/full-guide.md#packing-a-nuget-package).\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// build.fsx\r\n///\r\nlet pack = BuildTask.create \u0022Pack\u0022 [clean; build; runTests; copyBinaries] {\r\n    if promptYesNo (sprintf \u0022creating stable package with version %s OK?\u0022 stableVersionTag ) \r\n        then\r\n            !! \u0022src/**/*.*proj\u0022\r\n            |\u003E Seq.iter (Fake.DotNet.DotNet.pack (fun p -\u003E\r\n                let msBuildParams =\r\n                    {p.MSBuildParams with \r\n                        Properties = ([\r\n                            \u0022Version\u0022,stableVersionTag\r\n                            \u0022PackageReleaseNotes\u0022,  (release.Notes |\u003E List.map replaceCommitLink |\u003E String.concat \u0022\\r\\n\u0022)\r\n                        ] @ p.MSBuildParams.Properties)\r\n                    }\r\n                {\r\n                    p with \r\n                        MSBuildParams = msBuildParams\r\n                        OutputPath = Some pkgDir\r\n                }\r\n            ))\r\n            /// This is used to create ISADotNet.Fable with the Fable subfolder as explained here:\r\n            /// https://fable.io/docs/your-fable-project/author-a-fable-library.html\r\n            \u0022src/ISADotNet/ISADotNet.fsproj\u0022\r\n            |\u003E Fake.DotNet.DotNet.pack (fun p -\u003E\r\n                let msBuildParams =\r\n                    {p.MSBuildParams with \r\n                        Properties = ([\r\n                            \u0022PackageId\u0022, \u0022ISADotNet.Fable\u0022\r\n                            \u0022Version\u0022,stableVersionTag\r\n                            \u0022Description\u0022,\u0022Fable compliant release for the ISA compliant experimental metadata toolkit in F#. Additionally to the compiled library, it is shipped with the uncompiled code.\u0022\r\n                            \u0022PackageTags\u0022,\u0022F# FSharp dotnet .Net bioinformatics biology datascience metadata investigation study assay ISA Json Fable\u0022\r\n                            \u0022PackageReleaseNotes\u0022,  (release.Notes |\u003E List.map replaceCommitLink |\u003E String.concat \u0022\\r\\n\u0022)\r\n                        ] @ p.MSBuildParams.Properties)\r\n                    }\r\n                let test = p\r\n                {\r\n                    p with \r\n                        MSBuildParams = msBuildParams\r\n                        OutputPath = Some pkgDir\r\n                }\r\n            )\r\n    else failwith \u0022aborted\u0022\r\n}\r\n\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n*(ISADotNet was changed and is at the time of writing not Fable compatible, because of the JSON parser library.)*\r\n\r\n## JS in FSharp\r\n\r\nSome of the following text is based on an explanation from the awesome guys at [@compositionalit](https://twitter.com/compositionalit)!\r\n\r\nOne of the big advantages of Fable is not only that F# code becomes accessible with JavaScript, but also that one can use JavaScript libraries in F#.\r\n\r\nThe javascript library that we\u0027ll be interacting with is [shuffle](https://www.npmjs.com/package/shuffle), because why should we implement a all those cards functions if they already exist ..\r\n\r\n### Installing the shuffle npm package\r\n\r\n1. Install the \u0060shuffle\u0060 package using \u0060npm\u0060 or \u0060yarn\u0060\r\n\r\n\u0060\u0060\u0060powershell\r\nnpm install shuffle\r\n\u0060\u0060\u0060\r\n\r\n### Dynamic casting\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// App.fs\r\n///\r\nopen Fable.Core.JsInterop\r\n\r\nlet shuffle: obj = importDefault \u0022shuffle\u0022\r\n\r\nconsole.log(shuffle)\r\n\u0060\u0060\u0060\r\n\r\n\u003E For more information on import statements in fable visit the [SAFE documentation](https://safe-stack.github.io/docs/recipes/javascript/import-js-module/) or the [offical Fable docs](https://fable.io/docs/).\r\n\r\n1. To check that the package has been brought in add \u0060console.log(shuffle)\u0060 within the \u0060App.fs\u0060 file\r\n\r\n2. Open the browsers console window (Shift \u002B \u2318 \u002B J (on macOS) or Shift \u002B CTRL \u002B J (on Windows/Linux)) and you should see something like:\r\n\r\n\u0060\u0060\u0060javascript\r\n{ Object\r\n    playingCards: \u0192 ()\r\n    shuffle: \u0192 (options)\r\n    [[Prototype]]: Object }\r\n\u0060\u0060\u0060\r\n\r\nIf you\u0027ve done something wrong such as mispelling the import you may see:\r\n\r\n\u0060\u0060\u0060javascript\r\nclient:159 ./src/App.fs.js\r\nModule not found: Error: Can\u0027t resolve \u0027shufle\u0027 in \u0027C:\\Users\\User\\source\\repos\\How2Fable\\src\u0027\r\n\u0060\u0060\u0060\r\n\r\n### Use dynamic casting to access members.\r\n\r\nDynamic casting relies on your understanding of the code. The \u0060?\u0060 operator allows us to access any members of our JsInterop elements.\r\n\r\nThe following is taken from the official documentation. We want to access those functions with the \u0060?\u0060 operator.\r\n\r\n\u0060\u0060\u0060javascript\r\n// shuffle documentation in JavaScript\r\nvar Shuffle = require(\u0027shuffle\u0027);\r\nvar deck = Shuffle.shuffle();\r\nvar card = deck.draw();\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060fsharp\r\n// Dynamic casting in F# \r\nlet shuffle: obj = importDefault \u0022shuffle\u0022\r\nlet deck : obj = shuffle?shuffle()\r\nlet card : obj = deck?draw()\r\nconsole.log(card)\r\n\u0060\u0060\u0060\r\n\r\nWe check our console and see that it worked and we got a random card consisting of 3 values: suit, description and sort.\r\nIn addition a \u0060card\u0060 has two more members \u0060toShortDisplayString\u0060 and \u0060toString\u0060. Which we can access in the same way.\r\n\r\n\u0060\u0060\u0060javascript\r\n// console.log(card)\r\n\r\nmodule.exports {suit: \u0027Spade\u0027, description: \u0027Ten\u0027, sort: 10, toString: \u0192, toShortDisplayString: \u0192}\r\ndescription: \u0022Ten\u0022\r\nsort: 10\r\nsuit: \u0022Spade\u0022\r\ntoShortDisplayString: \u0192 ()\r\ntoString: \u0192 ()\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060fsharp\r\n// F#\r\nconsole.log(card?toShortDisplayString())\r\nconsole.log(card?toString())\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060\r\n10S\r\nTen of Spades\r\n\u0060\u0060\u0060\r\n\r\nWe implement our dynamic casting functions for a button, by duplicating the button functionality with \u0060myButton2\u0060.\r\n\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EmyButton2\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060html\r\n\u003C!--index.html--\u003E\r\n\u003Cbody\u003E\r\n    \u003Cp\u003EFable is running\u003C/p\u003E\r\n    \u003Cp\u003EYou can click on this button:\u003C/p\u003E\r\n    \u003Cbutton class=\u0022my-button\u0022\u003EClick me\u003C/button\u003E\r\n    \u003C!--This is our new button--\u003E\r\n    \u003Cbutton class=\u0022my-button2\u0022\u003EClick me\u003C/button\u003E\r\n    \u003Cscript src=\u0022bundle.js\u0022\u003E\u003C/script\u003E\r\n\u003C/body\u003E\r\n\u0060\u0060\u0060\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// App.fs\r\n///\r\nopen Fable.Core.JsInterop\r\n\r\nlet mutable drawnCard2 = \u0022\u0022\r\n\r\nlet myButton2 = document.querySelector(\u0022.my-button2\u0022) :?\u003E Browser.Types.HTMLButtonElement\r\nmyButton2.onclick \u003C- fun _ -\u003E\r\n    drawnCard2 \u003C- JsInteropDynamicCasting.deck?drawRandom()?toString()\r\n    myButton2.innerText \u003C- sprintf \u0022You pulled: %s \u0022 drawnCard2\r\n\u0060\u0060\u0060\r\n\r\n\u003C/details\u003E\r\n\r\nAnd it works! \uD83C\uDF89\r\n\r\n![Fable example for dynamic casting button](../img/How2Fable_example2.png)\r\n\r\n### Setting up an interface\r\n\r\nRather than unsafely accessing the \u0060shuffle\u0060 it would be better to use an interface \r\nso that we can use the normal \u0060.\u0060 notation to call methods on \u0060shuffle\u0060.\r\n\r\nDeclare an interface type called \u0060Shuffle\u0060. This interface will have to be declared before:\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet Shuffle: obj = importDefault \u0022shuffle\u0022\r\n\u0060\u0060\u0060\r\n\r\nThe interface will need an \u0060\u0060abstract\u0060\u0060 member called \u0060shuffle\u0060 that is a function of type \u0060unit -\u003E obj\u0060.\r\n\r\n\u0060\u0060\u0060fsharp\r\ntype Shuffle =\r\n    abstract member shuffle: unit -\u003E obj\r\n\u0060\u0060\u0060\r\n\r\nUpdate the \u0060shuffle\u0060 import to use the new type \u0060Shuffle\u0060 rather than \u0060obj\u0060.\r\n\r\n\u0060\u0060\u0060diff\r\n--  let Shuffle: obj        = importDefault \u0022shuffle\u0022\r\n\u002B\u002B  let Shuffle: Shuffle    = importDefault \u0022shuffle\u0022  \r\n\u0060\u0060\u0060\r\n\r\nIn the end you can write Fable bindings for all functions of the npm library which could look like the following:\r\n\r\n\u0060\u0060\u0060fsharp\r\nmodule JsInteropInterface =\r\n\r\n    open Fable.Core.JsInterop   \r\n\r\n    type Cards = \r\n        abstract member suit: string with get, set\r\n        abstract member description: string with get, set\r\n        abstract member sort: int with get, set\r\n        abstract member toString: unit -\u003E string\r\n        abstract member toShortDisplayString: unit -\u003E string\r\n\r\n    type Deck =\r\n        abstract member length : int\r\n        abstract member cards: Cards []\r\n        abstract member draw : int -\u003E Cards\r\n        abstract member draw : unit -\u003E Cards\r\n        abstract member drawRandom : int -\u003E Cards\r\n        abstract member drawRandom : unit -\u003E Cards\r\n        abstract member putOnTopOfDeck: Cards -\u003E unit\r\n        abstract member putOnTopOfDeck: Cards [] -\u003E unit\r\n        abstract member putOnBottomOfDeck: Cards -\u003E unit\r\n        abstract member putOnBottomOfDeck: Cards [] -\u003E unit\r\n\r\n    type Shuffle =\r\n        abstract member shuffle: unit -\u003E Deck\r\n        abstract member shuffle: \u0027a -\u003E Deck\r\n        abstract member playingCards: unit -\u003E obj\r\n\r\n    let Shuffle: Shuffle = importAll \u0022shuffle\u0022  \r\n\u0060\u0060\u0060\r\n\r\nWith this done we can update our \u0060myButton2\u0060 to use our typesafe bindings. While we are at it, we change the mutable to an \u0060option\u0060 and \r\nstop initializing a new deck everytime we press the button. \r\n\r\n\u0060\u0060\u0060fsharp\r\nlet mutable drawnCard2 : Cards option = None\r\nlet deck = Shuffle.shuffle()\r\n\r\nlet myButton2 = document.querySelector(\u0022.my-button2\u0022) :?\u003E Browser.Types.HTMLButtonElement\r\nmyButton2.onclick \u003C- fun _ -\u003E\r\n    drawnCard2 \u003C- deck.draw() |\u003E Some\r\n    console.log deck.length\r\n    myButton2.innerText \u003C- sprintf \u0022You pulled: %s \u0022 (drawnCard2.Value.toString())\r\n\u0060\u0060\u0060\r\n\r\n### Typesafety?\r\n\r\nJavaScript is not type safe and while we are writing F# we use the JS runtime to execute our code. This is best shown in the following example.\r\nThe implemented \u0060deck.putOnTopOfDeck\u0060 if of type \u0060Cards -\u003E unit\u0060 or \u0060Cards [] -\u003E unit\u0060. Sadly, the author of \u0060shuffle\u0060 did not intend us to add more standard cards to the deck \r\nand does **not** expose the create function for us to use in Fable. Altough there are some options on how to circumvent this.\r\n\r\n#### Goal\r\n\r\nAdd a button which puts a specific card on top of the deck with \u0060deck.putOnTopOfDeck\u0060.\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EButton html\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060html\r\n\u003C!--index.html--\u003E\r\n\u003Cbody\u003E\r\n    \u003Cp\u003EFable is running\u003C/p\u003E\r\n    \u003Cp\u003EYou can click on this button:\u003C/p\u003E\r\n    \u003C!--This are our buttons--\u003E\r\n    \u003Cbutton class=\u0022my-button\u0022\u003EClick me\u003C/button\u003E\r\n    \u003Cbutton class=\u0022my-button2\u0022\u003EClick me\u003C/button\u003E\r\n    \u003Cbutton class=\u0022my-button3\u0022\u003EIs this allowed?\u003C/button\u003E\r\n    \u003Cscript src=\u0022bundle.js\u0022\u003E\u003C/script\u003E\r\n\u003C/body\u003E\r\n\u0060\u0060\u0060\r\n\r\n\u003C/details\u003E\r\n\r\nUse \u0060deck.putOnTopOfDeck\u0060 (with the array parameter overload, as the single card version seems to be buggy and does **not** work), but we still need the new card.\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet myButton3 = document.querySelector(\u0022.my-button3\u0022) :?\u003E Browser.Types.HTMLButtonElement\r\nmyButton3.onclick \u003C- fun _ -\u003E\r\n    deck.putOnTopOfDeck [||]\r\n    console.log deck.length\r\n\u0060\u0060\u0060\r\n\r\n#### Option 1: Search and explicit import.\r\n\r\nIt is possible to search through the JS library (\u0060\u0022\\node_modules\\shuffle\\src\\playingCard.js\u0022\u0060) to find the \u0060card\u0060 creation and definition logic.\r\nAnd even though it is not exported to the main \u0060index.js\u0060 we can access the exact file and use it to create \u0060Cards\u0060.\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet playingCard : obj = importDefault (\u0022../node_modules/shuffle/src/playingCard.js\u0022)\r\n// createNew is a Fable function to simulate the JS \u0060new\u0060 operator\r\nlet newCard = createNew playingCard (\u0022Heart\u0022, \u0022Five\u0022, 5) :?\u003E Cards\r\n\u0060\u0060\u0060\r\n\r\nThis is only necessary because the author did not intend this behavior, instead we are meant to write our own card type, as shown in the following example from the docs.\r\n\r\n\u0060\u0060\u0060javascript\r\n// shuffle docs in JavaScript\r\nvar Shuffle = require(\u0027shuffle\u0027);\r\nvar goFish = [{color: \u0027red\u0027, number: 1}, {color: \u0027blue\u0027, number: 2}, ...];\r\nvar deck = Shuffle.shuffle({deck: goFish});\r\n\u0060\u0060\u0060\r\n\r\nBut more on that later.\r\n\r\n#### Option 2: Anonymous records and createObject\r\n\r\nWe could imitate the JS \u0060card\u0060 object with different options. Fable translates F# anonymous records to JS objects.\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet newCard : Cards = !!{|suit = \u0022Heart\u0022; description = \u0022Five\u0022; sort = 5|}\r\n\u0060\u0060\u0060\r\n\r\nAlthough \u0060deck.putOnTopOfDeck\u0060 is of type \u0060Cards [] -\u003E unit\u0060 we can handle the anonymous record as such, because of the \u0060!!\u0060 operator. \r\nIt more or less tells the dotnet compiler to not worry about typesafety for whatever follows it. Therefore we can declare \u0060newCard : Cards\u0060.\r\n\r\nIf we just add this card to the input array we will get an error, because we try to call the \u0060toString()\u0060 method on the drawn cards and our anonymous record type has no such member.\r\n_But_ we can replace \u0060drawnCard2.Value.toString()\u0060 with for example \u0060drawnCard2.Value.suit\u0060 and it will work just fine! \uD83C\uDF89\r\nThe Javascript compiler will try to access the \u0060suit\u0060 member and both \u0060Cards\u0060 as well as our anonymous record have this member and we can change the print command accordingly.\r\n\r\nFable provides us with even more alternatives, which work just like the anonymous record type as they will **not** contain the \u0060toString()\u0060 method.\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EAlternative 1\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet newCard = createEmpty\u003CCards\u003E\r\nnewCard.suit \u003C- \u0022Heart\u0022\r\nnewCard.description \u003C- \u0022Five\u0022\r\nnewCard.sort \u003C- 5\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\r\n\u003Cdetails\u003E\r\n\u003Csummary\u003EAlternative 2\u003C/summary\u003E\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet newCard = jsOptions\u003CCards\u003E(fun newCard -\u003E\r\n    newCard.suit \u003C- \u0022Heart\u0022\r\n    newCard.description \u003C- \u0022Five\u0022\r\n    newCard.sort \u003C- 5\r\n)\r\n\u0060\u0060\u0060\r\n\u003C/details\u003E\r\n\r\n\u003Cbr\u003E\r\n\r\n#### Option 3: F# Record type\r\n\r\nAs we just saw we can circumvent type safety quite easily and the author already intends us to write our own card type, so we will do exactly that. \u003Csub\u003E(Please do not cringe about the following joke)\u003C/sub\u003E\r\n\r\n\u0060\u0060\u0060fsharp\r\n/// App.fs\r\n///\r\n// https://fable.io/docs/communicate/fable-from-js.html\r\n[\u003CAttachMembers\u003E]\r\ntype MyCard = {\r\n    Name : string\r\n} with\r\n    static member create name = {Name = name}\r\n    member this.toString() =\r\n        match this.Name with\r\n        | \u0022Exodia\u0022 -\u003E $\u0022{this.Name} \uD83D\uDE31. That means you win!\u0022\r\n        | anythingElse -\u003E $\u0022{anythingElse}?? ..\u0022\r\n\u0060\u0060\u0060\r\n\r\nThis type is rather different to the \u0060Cards\u0060 type, except it also contains a \u0060.toString()\u0060 method. So we will tell \r\nthe typesafe dotnet compiler to not worry and will add our \u0022Joker\u0022 to the pile of poker cards.\r\nBecause the only time we interact with the card will be when we call the \u0060.toString()\u0060 method it will work without any problems.\r\n\r\n\u0060\u0060\u0060fsharp\r\nlet myButton3 = document.querySelector(\u0022.my-button3\u0022) :?\u003E Browser.Types.HTMLButtonElement\r\nmyButton3.onclick \u003C- fun _ -\u003E\r\n    let newCard = !!MyCard.create \u0022Exodia\u0022\r\n    deck.putOnTopOfDeck [|newCard|]\r\n    console.log deck.length\r\n\u0060\u0060\u0060\r\n\r\n![Fable example ignoring type safety button](../img/How2Fable_example3.png)\r\n\r\nThis is an extreme example on how JS and F# will interact through Fable. By ignoring the F# typesafety with \u0060!!\u0060 or \r\nusing dynamic casting we make our code error-prone. It would be better to write the bindings in a way to directly work with the intended card type, \r\nas all functions will work independently of the card type used.\r\n\r\nUsing existing JS libraries for Fable applications can safe a lot of time, so knowing how to use the \u2013 often \u2013 excellent work of other \r\nprogrammers is valuable know-how... and result in less time wasted recreating already existing libraries.\r\n\r\n## Further reading\r\n\r\n- [Official Fable docs](https://fable.io/docs/)\r\n- [Computational IT Blogs](https://www.compositional-it.com/news-blog/)\r\n\r\nBlogpost ressources\r\n\r\n- [Fable REPL](https://fable.io/repl/)\r\n- [Fable compatible F# Core libraries](https://fable.io/docs/dotnet/compatibility.html)\r\n- [Fable compatible community ressources](https://fable.io/resources.html#Libraries)\r\n- [Shuffle](https://www.npmjs.com/package/shuffle)\r\n- [SAFE stack](https://safe-stack.github.io/docs/intro/)\r\n"},{"uri":"/CSBlog/posts/3_sequence_features.html","title":"Modelling and visualizing sequence features with BioFSharp and Plotly.NET","content":"(**\n\n---\ntitle: Modelling and visualizing sequence features with BioFSharp and Plotly.NET\ncategory: Implementation\ncategoryindex: 3\nindex: 3\n---\n*)\n\n(***hide***)\n#r \u0022nuget: BioFSharp, 2.0.0-beta7\u0022\n#r \u0022nuget: BioFSharp.IO, 2.0.0-beta6\u0022\n#r \u0022nuget: Newtonsoft.JSON, 12.0.3\u0022\n#r \u0022nuget: DynamicObj\u0022\n#r \u0022nuget: FSharp.Stats, 0.4.3\u0022\n\nopen BioFSharp\nopen System.IO\n\ntype SequenceFeature = {\n    Name: string\n    //zero-based\n    Start: int\n    //zero-based\n    End: int\n    Length: int\n    Abbreviation: char\n    Metadata: Map\u003Cstring,string\u003E\n    FeatureType: string\n} with\n    static member create \n        (\n            name: string,\n            featureStart: int,\n            featureEnd: int,\n            ?Abbreviation: char,\n            ?Metadata: Map\u003Cstring,string\u003E,\n            ?FeatureType: string\n        ) =\n            if featureStart \u003C 0 || featureEnd \u003C 0 || featureStart \u003E featureEnd then\n                failwith $\u0022invalid feature stretch ({featureStart},{featureEnd})\u0022\n            else\n                {\n                    Name            = name        \n                    Start           = featureStart\n                    End             = featureEnd  \n                    Length          = featureEnd - featureStart \u002B 1\n                    Abbreviation    = Abbreviation |\u003E Option.defaultValue \u0027 \u0027\n                    Metadata        = Metadata |\u003E Option.defaultValue (Map.ofList [])\n                    FeatureType     = FeatureType |\u003E Option.defaultValue \u0022\u0022\n                }\n\n    static member tryGetIntersection (feature1:SequenceFeature) (feature2:SequenceFeature) =\n        let s1,e1 = feature1.Start, feature1.End\n        let s2,e2 = feature2.Start, feature2.End\n        \n        if (s2 \u003E e1) || (s1 \u003E e2) then\n            None\n        else\n            Some ((max s1 s2), (min e1 e2))\n\ntype AnnotatedSequence\u003C\u0027T when \u0027T :\u003E IBioItem\u003E = \n    {\n        Tag: string\n        Sequence : seq\u003C\u0027T\u003E\n        Features: Map\u003Cstring,SequenceFeature list\u003E\n    } \n\nmodule AnnotatedSequence =\n    \n    let create tag sequence (featureMap: Map\u003Cstring,SequenceFeature list\u003E) =\n\n        let mutable hasInvalidFeatures = false\n        let mutable invalidFeatures: (string*(SequenceFeature*SequenceFeature)) list = []\n\n        let isOverlap (stretch1:int * int) (stretch2: int * int) =\n            let s1, e1 = stretch1\n            let s2, e2 = stretch2\n\n            (s1 \u003C= s2 \u0026\u0026 e1 \u003E= s2)\n            || (s1 \u003C= s2 \u0026\u0026 e1 \u003E= e2)\n            || (s1 \u003C= e2 \u0026\u0026 e1 \u003E= e2)\n            || (s1 \u003E= s2 \u0026\u0026 e1 \u003C= e2)\n\n        featureMap\n        |\u003E Map.iter (fun key features -\u003E\n            let rec loop (featureList:SequenceFeature list) =\n                match featureList with\n                | f::rest -\u003E \n                    for frest in rest do \n                        if isOverlap (f.Start, f.End) (frest.Start, frest.End) then \n                            hasInvalidFeatures \u003C- true\n                            invalidFeatures \u003C- (key,(f,frest))::invalidFeatures\n                    loop rest\n                | [] -\u003E ()\n            loop features\n        )\n        if hasInvalidFeatures then\n            failwith $\u0022\u0022\u0022At least one  sequence feature annotation collection contains overlapping annotations. This is not supported. Please annotate them as separate feature lists.\nOffending annotations: \n{invalidFeatures}\n\u0022\u0022\u0022         \n        else\n            {\n                Tag = tag\n                Sequence = sequence\n                Features= featureMap\n            }\n\n    let addFeatures (featureKey: string) (features: SequenceFeature list) (anns: AnnotatedSequence\u003C_\u003E) =\n        {\n            anns with\n                Features = \n                    if Map.containsKey featureKey anns.Features then\n                        anns.Features |\u003E Map.add featureKey (features @ anns.Features.[featureKey])\n                    else\n                        anns.Features |\u003E Map.add featureKey features\n                \n        }\n\n    let toStrings (anns: AnnotatedSequence\u003C_\u003E) =\n        let sequenceString = anns.Sequence |\u003E Seq.map (BioItem.symbol \u003E\u003E string) |\u003E String.concat \u0022\u0022\n        let emptyFormatString = [for i in 1 .. (Seq.length anns.Sequence) do yield \u0022 \u0022] |\u003E String.concat \u0022\u0022\n        let featureFormats =\n            anns.Features\n            |\u003E Map.map (fun key features -\u003E \n                features\n                |\u003E Seq.fold (fun (acc:string) (feature) -\u003E\n                    let featureStretch = [for _ in 1 .. feature.Length do yield (feature.Abbreviation |\u003E string)] |\u003E String.concat \u0022\u0022\n                    acc\n                        .Remove(feature.Start, feature.Length)\n                        .Insert(feature.Start, featureStretch)\n                ) emptyFormatString\n            )\n        sequenceString,featureFormats\n\n    let format (anns: AnnotatedSequence\u003C_\u003E) =\n        let sequenceString, featureStrings = anns |\u003E toStrings\n        let longestId = \n            [\u0022Sequence\u0022; yield! (featureStrings |\u003E Map.toList |\u003E List.map fst)] \n            |\u003E Seq.maxBy (fun x -\u003E x.Length)\n            |\u003E fun s -\u003E s.Length\n\n        let ids = \n            [\u0022Sequence\u0022; yield! (featureStrings |\u003E Map.toList |\u003E List.map fst)]\n            |\u003E List.map (fun s -\u003E s.PadRight(longestId\u002B4))\n        \n        let blocks = \n            [sequenceString; yield! (featureStrings |\u003E Map.toList |\u003E List.map snd)]\n            |\u003E List.mapi (fun index seqString -\u003E\n                let id = ids.[index]\n                let splits = \n                    seqString.ToCharArray() \n                    |\u003E Seq.map string\n                    |\u003E Seq.chunkBySize 60 \n                    |\u003E Seq.map (String.concat \u0022\u0022)\n\n                let innerSplits = \n                    splits |\u003E Seq.map (fun s -\u003E \n                        s.ToCharArray() \n                        |\u003E Seq.map string\n                        |\u003E Seq.chunkBySize 10 \n                        |\u003E Seq.map (String.concat \u0022\u0022)\n                )\n\n                innerSplits \n                |\u003E Seq.mapi (fun i strs -\u003E  \n                    let line = \n                        strs \n                        |\u003E Seq.fold (fun acc elem -\u003E sprintf \u0022%s %s\u0022 acc elem) \u0022\u0022 \n                    $\u0022{id} {(string (((i\u002B1)*60) - 60 \u002B 1)).PadLeft(10)}{line}\u0022 \n                )\n                |\u003E Array.ofSeq\n            )\n\n        [for i in 0 .. blocks.[0].Length-1 do\n            for b in blocks do yield b.[i]\n        ]\n        |\u003E String.concat System.Environment.NewLine\n        |\u003E fun s -\u003E $\u0022{System.Environment.NewLine}{s}{System.Environment.NewLine}\u0022\n\n(**\n# Modelling and visualizing sequence features with BioFSharp and Plotly.NET\n\n### Table of contents\n\n- [Assigning secondary structure for proteins based on .pdb files](#Assigning-secondary-structure-for-proteins-based-on-pdb-files)\n- [Comparing structural annotations](#Comparing-structural-annotations)\n- [Generalizing sequence features]()\n    - [Implementing the Sequence feature](#Implementing-the-Sequence-feature)\n    - [Implementing the Annotated Sequence](#Implementing-the-Annotated-Sequence)\n- [Visualizing sequence features with Plotly.NET](#Visualizing-sequence-features-with-Plotly-NET)\n    - [Plotting sequences with Plotly.NET](#Plotting-sequences-with-Plotly-NET)\n    - [A sequence feature view plot for AnnotatedSequence](#A-sequence-feature-view-plot-for-AnnotatedSequence)\n\n\n## Assigning secondary structure for proteins based on .pdb files\n\nI recently started to work with a lot of structural protein data with the aim of extracting features based on the proteins secondary structures.\n\nThis involved assigning secondary structures for \u0060.pdb\u0060 files, which is a file format that contains positional information about each atom in a polipeptide chain.\nAs in many bioinformatic fields, tried-and-tested algorithms for this are several decades old but seem to be still the gold standard. \nThe algorithm that pops up most is [**DSSP**](https://swift.cmbi.umcn.nl/gv/dssp/) (Dictionary of Protein Secondary Structure). You can clearly see the age in every ounce of that website.\n\nDSSP was originally used to assign all secondary structures for the [PDB (Protein Data bank)](https://www.rcsb.org/). I cannot find a source if that is still the case though. \n\u0060.pdb\u0060 files obtained from PDB usually already contain a section with the assigned structures, but this is not true for example for the output of alpha fold, which only predicts the raw atom positions without any structure assignment.\n\nUsing dssp is straight forward, it can be installed directly via apt on ubuntu, and there is a biocontainer available [here](https://biocontainers.pro/tools/dssp)\n\ndssp itself is also very easy to use. Once in the container, simply run\n\n\u0060\u0060\u0060bash\ndssp -i \u003C.pdb file\u003E -o \u003Cdssp file\u003E\n\u0060\u0060\u0060\n\nThe output format of DSSP is weird, but writing parsers is not too hard. It contains metadata sections indicated by the line start, which are not very interesting fort my purposes.\nThe structure assignments are contained in a fixed-column data format further down the file. \n\nHere is an example of how it looks like:\n\n\u0060\u0060\u0060no-highlight\n#  RESIDUE AA STRUCTURE BP1 BP2  ACC     N-H--\u003EO    O--\u003EH-N    N-H--\u003EO    O--\u003EH-N    TCO  KAPPA ALPHA  PHI   PSI    X-CA   Y-CA   Z-CA            CHAIN\n  1    1 A M              0   0  235      0, 0.0     4,-0.1     0, 0.0     0, 0.0   0.000 360.0 360.0 360.0  58.6   -7.4   17.5   38.1               \n  2    2 A Y     \u003E  \u002B     0   0  202      2,-0.1     4,-0.6     3,-0.1     0, 0.0   0.539 360.0  69.8-121.3  -9.6   -8.6   17.8   34.5               \n  3    3 A Y  H  \u003E S\u002B     0   0  209      1,-0.2     4,-1.1     2,-0.2     3,-0.3   0.865  91.2  58.3 -82.3 -33.1   -5.5   19.3   32.5               \n  4    4 A F  H  \u003E S\u002B     0   0  193      1,-0.2     4,-1.7     2,-0.2    -1,-0.2   0.861 101.0  56.5 -67.1 -33.2   -3.2   16.2   32.7               \n  5    5 A S  H  \u003E S\u002B     0   0   91      1,-0.2     4,-1.5     2,-0.2    -1,-0.2   0.835 104.5  51.5 -71.2 -31.9   -5.6   13.8   31.0               \n  6    6 A R  H  X S\u002B     0   0  204     -4,-0.6     4,-1.4    -3,-0.3    -1,-0.2   0.816 108.4  51.3 -75.1 -30.1   -6.0   16.0   27.8               \n  7    7 A V  H  X S\u002B     0   0   96     -4,-1.1     4,-1.8     2,-0.2    -2,-0.2   0.924 110.2  49.0 -72.1 -41.8   -2.2   16.3   27.3               \n  8    8 A A  H  X S\u002B     0   0   54     -4,-1.7     4,-1.9     1,-0.2    -2,-0.2   0.860 109.1  52.8 -65.7 -36.0   -1.8   12.5   27.5               \n  9    9 A A  H  X S\u002B     0   0   65     -4,-1.5     4,-1.7     2,-0.2    -1,-0.2   0.885 108.6  50.6 -67.1 -36.6   -4.6   11.9   25.0               \n 10   10 A R  H  X S\u002B     0   0  206     -4,-1.4     4,-1.6     2,-0.2    -2,-0.2   0.888 110.4  48.5 -68.7 -39.2   -2.9   14.3   22.5               \n 11   11 A T  H  X S\u002B     0   0   84     -4,-1.8     4,-1.6     2,-0.2    -2,-0.2   0.894 109.7  52.6 -70.1 -36.5    0.5   12.5   22.7               \netc.\n\u0060\u0060\u0060\n\nWriting a parser for that section was straight forward. I added it to [BioFSharp.IO]() if you are interested in using it yourself.\n\n## Comparing structural annotations\n\nWithout going into too much detail, one of the things I am interested in is how the structural assignments of DSSP relate to other structural annotations for it.\nAn example would be **intrinsically disordered stretches**, parts of the chain that do not have a structure, but this disorder is actually crucial for the proteins function.\n\nYou can read more about disorder in protein structures [here](https://en.wikipedia.org/wiki/Intrinsically_disordered_proteins). An awesome ressource for disorder annotations is [DisProt](https://disprot.org/). You can download its annotations in an easily usable tsv format (no custom parsing yay).\nWith these two annotations at hand, i started scripting with BioFSharp and Plotly.NET to get visual comparisons of both features (DSSP structure and disprot annotation).\n\nMy first attempts involved chunking the sequence and annotations by 60 and creating a annotated heatmap, assigning color based on the one character code of the structure. It achieved the goal, but was very hard to read, especially for large sequences.\nI wont even include the source code for this, because it obviously sucks:\n\n\u003Cbr\u003E\n\u003Chr\u003E\n\n![heatmap](/img/heatmap.png)\n\n_Fig1: My first pitiful attempt at visualizing sequence features_\n\u003Chr\u003E\n\u003Cbr\u003E\n\nAt this point, i thought i was pretty much near the goal of my project (i calculated some fancy metrics downstream from the features that do not belong in this post),\nand therefore content with the visualization. But as often happens in any kind of project - especially in academia - the scale of the project increased and i wanted to include more features in my calculations.\n\nOne was the secondary structure assigment of [Stride](http://webclu.bio.wzw.tum.de/stride/) - basically an improved version of DSSP. Also, i wanted to look at different disprot annotations individually.\nAt this point, a generic solution for both handling sequence features as well as their visualization was needed.\n\nStride is not as straight-forward to use as DSSP. I ended up creating my own docker container that builds it from [source](http://webclu.bio.wzw.tum.de/stride/install.html):\n\n\u0060\u0060\u0060dockerfile\nFROM biocontainers/biocontainers:vdebian-buster-backports_cv1\n\nUSER root\nRUN apt-get update \u0026\u0026 (apt-get install -t buster-backports -y gcc || apt-get install -y gcc) \u0026\u0026 (apt-get install -t buster-backports -y make || apt-get install -y make) \u0026\u0026 apt-get clean \u0026\u0026 apt-get purge\n\nWORKDIR /bin/stride\nCOPY ./stride.tar.gz /bin/stride\n\nENV DEBIAN_FRONTEND noninteractive\nRUN tar -zxf stride.tar.gz\nRUN make\nENV PATH=\u0022/bin/stride/:${PATH}\u0022\n\nWORKDIR /data\nUSER biodocker\n\u0060\u0060\u0060\n\n## Implementing the Sequence feature\n\nA sequence feature in its most basic form just need start and end index within the sequence. They are usually abbreviated by a one-character code in most visualizations, and DSSP as well as Stride use on-letter codes for their assignment. \nI added additional metadata such as the name, type, and length of the feature, as well as arbitrary metadata. The full implementation in BioFSharp can be seen [here]()\n\n\u0060\u0060\u0060\ntype SequenceFeature = \n    {\n        Name: string\n        //zero-based\n        Start: int\n        //zero-based\n        End: int\n        Length: int\n        Abbreviation: char\n        Metadata: Map\u003Cstring,string\u003E\n        FeatureType: string\n    }\n\n\u0060\u0060\u0060\n\n## Implementing the Annotated Sequence\n\nAn annotated sequence is a sequence which has feature annotations. I decided to model these as a Map of sequence features, where the key represents the feature type, and the list contains the individual feature stretches of that type.\nThe sequence can also be tagged with a string to give it an identifier:\n\n\u0060\u0060\u0060\ntype AnnotatedSequence\u003C\u0027T when \u0027T :\u003E IBioItem\u003E = \n    {\n        Tag: string\n        Sequence : seq\u003C\u0027T\u003E\n        Features: Map\u003Cstring,SequenceFeature list\u003E\n    } \n\n\u0060\u0060\u0060\n\nThe full implementation with all additional functions can be found in BioFSharp [here]()\n\nBased on this type, i first created a pretty printer in the fasta style to see if i was going in the right direction:\n\n*)\nopen BioFSharp\n\nlet testSeq = \n    AnnotatedSequence.create\n        \u0022Test\u0022\n        (\u0022ATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAG\u0022 |\u003E BioArray.ofNucleotideString)\n        (Map.ofList [\n            \u0022Feature1\u0022, [SequenceFeature.create(\u0022F1\u0022,0,10,\u0027A\u0027)]\n            \u0022Feature2\u0022, [SequenceFeature.create(\u0022F2\u0022,0,10,\u0027B\u0027); SequenceFeature.create(\u0022F2\u0022,100,120,\u0027B\u0027)]\n            \u0022Feature3\u0022, [SequenceFeature.create(\u0022F3\u0022,30,90,\u0027C\u0027)]\n\n        ])\n\nAnnotatedSequence.format testSeq\n(***include-it***)\n\n(**\nSo with this type modelling i was able to annotate a sequence with arbitrary features and visualize their positions. This text-based representation has the same problems as my heatmap approach though: it gets quite hard to read with increasing sequence length and feature count.\nStill, this is a nice pretty prionter for usage with \u0060fsi.AddPrinter\u0060.\n\n# Visualizing sequence features with Plotly.NET\n\nI took heavy inspiration from DisProt\u0027s sequence viewer, which displays feature lanes below the actual sequence as bars.\n\n## Plotting sequences with Plotly.NET\n\nTo plot a sequence of characters on a 2D plot, we can leverage Plotly.NETs \u0060Annotations\u0060. \nTo give the annotations points that can trigger hovertext, i added an invisible line trace behind them.\n*)\n#r \u0022nuget: Plotly.NET, 2.0.0-preview.16\u0022\n\nopen Plotly.NET\nopen Plotly.NET.LayoutObjects\n\nlet testSeqChart = \n    Chart.Line(\n        [for i in 0..3 -\u003E (i,1)], \n        MultiText=[\u0022A\u0022;\u0022T\u0022;\u0022G\u0022;\u0022C\u0022], \n        Opacity=0.0,\n        ShowLegend = false,\n        LineColor= Color.fromKeyword Black\n    )\n    |\u003E Chart.withAnnotations (\n        [\u0022A\u0022;\u0022T\u0022;\u0022G\u0022;\u0022C\u0022]\n        |\u003E Seq.mapi (fun x text -\u003E\n                Annotation.init(\n                    x,1,\n                    Text=(string text),\n                    ShowArrow=false,\n                    Font = Font.init(Size=16.)\n                )\n        )\n    )\n\n(**\n\u003Chr\u003E\n*)\n\n(***hide***)\ntestSeqChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 2: A simple sequence plot using Plotly.NET\u0027s Annotations._\n\u003Chr\u003E\n\u003Cbr\u003E\n*)\n\n(**\nWith some additional styling, we can make this look pretty good already:\n\n- Remove the Y axis\n- Mirror the X Axis\n- Add spike lines per default (very usefull later when combining with the feature traces)\n\n*)\n\ntype Chart with\n    static member SequencePlot\n        (\n            annotationText: #seq\u003Cstring\u003E,\n            ?FontSize: float\n        ) =\n            let fontSize = defaultArg FontSize 16.\n\n            Chart.Line(\n                [for i in 0..((Seq.length annotationText) - 1) -\u003E (i,1)], \n                MultiText=annotationText, \n                Opacity=0.0,\n                ShowLegend = false,\n                LineColor= Color.fromKeyword Black\n            )\n            |\u003E Chart.withXAxis(\n                LinearAxis.init(\n                    Visible=true, \n                    ShowLine= true, \n                    ShowTickLabels = true, \n                    ShowSpikes= true, \n                    ZeroLine = false, \n                    Range= StyleParam.Range.MinMax(0.,60.), // as default, show the first 60 characters. Double click to zoom out.\n                    Title = Title.init(\u0022Sequence index (0-based)\u0022, Font=Font.init(Size=fontSize)),\n                    TickFont = Font.init(Size=fontSize),\n                    Ticks = StyleParam.TickOptions.Inside,\n                    Mirror = StyleParam.Mirror.AllTicks\n                )\n            )        \n            |\u003E Chart.withYAxis(\n                LinearAxis.init(Visible=false, ShowLine= false, ShowTickLabels = false, ShowGrid = false, ZeroLine=false)\n            )\n            |\u003E Chart.withAnnotations (\n                annotationText\n                |\u003E Seq.mapi (fun x text -\u003E\n                    Annotation.init(\n                        x,1,\n                        Text=(string text),\n                        ShowArrow=false,\n                        Font = Font.init(Size=fontSize)\n                    )\n                )\n            )\n\nlet seqPlot = \n    Chart.SequencePlot(testSeq.Sequence |\u003E Seq.map (BioItem.symbol \u003E\u003E string))\n    |\u003E Chart.withSize(1000)\n\n(**\n\u003Chr\u003E\n*)\n\n(***hide***)\nseqPlot |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 3: A better styled version of the Sequence plot._\n\u003Chr\u003E\n\u003Cbr\u003E\n*)\n\n(**\n## A sequence feature view plot for AnnotatedSequence\n\nNow we need to add the feature traces. While Plotly.NET supports shapes to draw on a Plot, these have the disadvantage of not triggering hover events (at least to my knowledge).\n\nSo i decided to render each feature as a horizontal Bar trace, setting its \u0060Base\u0060 property (the Bar start) to the feature start, and the length accordingly.\n\nUsing \u0060Chart.SingleStack\u0060 in shared axis mode together with the previous sequence plot, this has the additional advantage that spikelines of the sequence plot span over the features (try hovering over the sequence below)\n\n*)\n\nlet featureTraceTestPlot = \n    [\n        Chart.SequencePlot(testSeq.Sequence |\u003E Seq.map (BioItem.symbol \u003E\u003E string))\n        [\n            Chart.Bar([\u0022Feature1\u0022, 20], Base=10, ShowLegend = false)\n            Chart.Bar([\u0022Feature1\u0022, 20], Base=41, ShowLegend = false)\n            Chart.Bar([\u0022Feature2\u0022, 50], Base=20, ShowLegend = false)\n        ]\n        |\u003E Chart.combine\n    ]\n    |\u003E Chart.SingleStack(Pattern=StyleParam.LayoutGridPattern.Coupled)\n    |\u003E Chart.withSize(1000)\n\n(**\n\u003Chr\u003E\n*)\n\n(***hide***)\nfeatureTraceTestPlot |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 4: Bar traces with different bases can be used in a stacked chart to indicate features mapping to the sequence position of the sequence plot on top._\n\u003Chr\u003E\n\u003Cbr\u003E\n*)\n\n(**\n\nThat looks exactly like i wanted it to turn out!\n\nThe rest is now a matter of styling. here is what i did additionally (in words):\n\n- render all features with the same color, unless indicated otherwise by a color mapping function\n- As seen on the plot above, When there are multiple features in a single lane, they get rendered with a y offset. This can be overcome by setting the barmode of the chart layout to \u0060Overlay\u0060\n- Add a x axis range slider to give more exploratory power\n\nAnd here is the final result (in code):\n\n*)\n\n\ntype Chart with\n    static member SequenceFeatureView\n        (\n            annotatedSequence: AnnotatedSequence\u003C_\u003E,\n            ?FontSize: float,\n            ?ColorMapping: seq\u003C(string*Color)\u003E,\n            ?ShowRangeSlider: bool\n        ) =\n            let showRangeSlider = defaultArg ShowRangeSlider true\n            let sequenceString = annotatedSequence.Sequence |\u003E Seq.map (BioItem.symbol \u003E\u003E string)\n\n            let featureColorMap = \n                ColorMapping\n                |\u003E Option.defaultValue Seq.empty\n                |\u003E Map.ofSeq\n\n            let featurePlots =\n                annotatedSequence.Features\n                |\u003E Map.toSeq\n                |\u003E Seq.map (fun (featureName,features) -\u003E\n                    features\n                    |\u003E List.map (fun f -\u003E\n                        Chart.Bar(\n                            [featureName,f.Length-1], \n                            Width=0.8, \n                            Base=f.Start, \n                            Text = $\u0022({f.Start}-{f.End}):  {f.Abbreviation}\u0022, \n                            TextPosition = StyleParam.TextPosition.Inside,\n                            ShowLegend = false,\n                            MarkerColor = (Map.tryFind featureName featureColorMap |\u003E Option.defaultValue (Color.fromKeyword Black))\n                        )\n                    \n                    )\n                )\n                |\u003E Seq.concat\n\n            [\n                Chart.SequencePlot(sequenceString, ?FontSize = FontSize)\n                |\u003E Chart.withYAxis(\n                    LinearAxis.init(Domain = StyleParam.Range.MinMax(0.81,1.))\n                )\n\n                featurePlots\n                |\u003E Chart.combine\n                |\u003E Chart.withYAxis(\n                    LinearAxis.init(ShowGrid=true, FixedRange = false, Domain = StyleParam.Range.MinMax(0.,0.79))\n                )\n            ]\n            |\u003E Chart.SingleStack(Pattern = StyleParam.LayoutGridPattern.Coupled)\n            |\u003E fun c -\u003E \n                if showRangeSlider then\n                    c\n                    |\u003E Chart.withXAxisRangeSlider(\n                        RangeSlider.init(BorderColor=Color.fromKeyword Gray, BorderWidth=1.)\n                    )\n                else\n                    c\n            |\u003E Chart.withConfig(\n                Config.init(ModeBarButtonsToAdd=[\n                    StyleParam.ModeBarButton.ToggleSpikelines\n                ])\n            )\n            |\u003E Chart.withLayout(\n                Layout.init(\n                    BarMode = StyleParam.BarMode.Overlay\n                )\n            )\n            |\u003E Chart.withTitle $\u0022Sequence feature view for {annotatedSequence.Tag}\u0022\n\n(**\nHere is what it looks like with a big test sequence:\n*)\n\nlet bigTestSeq = \n    AnnotatedSequence.create\n        \u0022test sequence\u0022\n        (\u0022ATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTCATGCTAGTGTC\u0022 |\u003E BioArray.ofNucleotideString)\n        (Map.ofList [\n            \u0022Feature 1\u0022, [SequenceFeature.create(\u0022F\u0022,1,33,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,50,60,\u0027D\u0027)]\n            \u0022Feature 2\u0022, [SequenceFeature.create(\u0022F\u0022,0,30,\u0027L\u0027);  SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,100,\u0027L\u0027)]\n            \u0022Feature 3\u0022, [SequenceFeature.create(\u0022F\u0022,8,83,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,84,100,\u0027D\u0027)]\n            \u0022Feature 4\u0022, [SequenceFeature.create(\u0022F\u0022,80,85,\u0027L\u0027); SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,79,\u0027L\u0027)]            \n            \u0022Feature 5\u0022, [SequenceFeature.create(\u0022F\u0022,1,33,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,50,60,\u0027D\u0027)]\n            \u0022Feature 6\u0022, [SequenceFeature.create(\u0022F\u0022,0,30,\u0027L\u0027);  SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,100,\u0027L\u0027)]\n            \u0022Feature 7\u0022, [SequenceFeature.create(\u0022F\u0022,8,83,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,84,100,\u0027D\u0027)]\n            \u0022Feature 8\u0022, [SequenceFeature.create(\u0022F\u0022,80,85,\u0027L\u0027); SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,79,\u0027L\u0027)]\n            \u0022Feature 9\u0022, [SequenceFeature.create(\u0022F\u0022,1,33,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,50,60,\u0027D\u0027)]\n            \u0022Feature 10\u0022,[SequenceFeature.create(\u0022F\u0022,0,30,\u0027L\u0027);  SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,100,\u0027L\u0027)]\n            \u0022Feature 11\u0022,[SequenceFeature.create(\u0022F\u0022,8,83,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,84,100,\u0027D\u0027)]\n            \u0022Feature 12\u0022,[SequenceFeature.create(\u0022F\u0022,80,85,\u0027L\u0027); SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,79,\u0027L\u0027)]            \n            \u0022Feature 13\u0022,[SequenceFeature.create(\u0022F\u0022,1,33,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,50,60,\u0027D\u0027)]\n            \u0022Feature 14\u0022,[SequenceFeature.create(\u0022F\u0022,0,30,\u0027L\u0027);  SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,100,\u0027L\u0027)]\n            \u0022Feature 15\u0022,[SequenceFeature.create(\u0022F\u0022,8,83,\u0027X\u0027);  SequenceFeature.create(\u0022F\u0022,84,100,\u0027D\u0027)]\n            \u0022Feature 16\u0022,[SequenceFeature.create(\u0022F\u0022,80,85,\u0027L\u0027); SequenceFeature.create(\u0022F\u0022,40,50,\u0027E\u0027); SequenceFeature.create(\u0022F\u0022,52,79,\u0027L\u0027)]\n        ])\n\nlet finalChart =\n    Chart.SequenceFeatureView(\n        bigTestSeq,\n        ColorMapping = [\u0022Feature 10\u0022, Color.fromKeyword DarkSalmon] // show feature 10 in a different color\n    )\n    |\u003E Chart.withSize(1000)\n\n(**\n\u003Chr\u003E\n*)\n\n(***hide***)\nfinalChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 5: The final result of my feature view plotting efforts._\n\u003Chr\u003E\n*)"},{"uri":"/CSBlog/posts/4_qvalues.html","title":"q values","content":"(**\n\n---\ntitle: q values\ncategory: Learning resources\ncategoryindex: 4\nindex: 0\n---\n*)\n\n\n(***hide***)\n#r \u0022nuget: FSharpAux, 1.1.0\u0022\n#r \u0022nuget: Plotly.NET, 2.0.0-preview.16\u0022\n#r \u0022nuget: FSharp.Stats, 0.4.3\u0022\n\nopen Plotly.NET\nopen Plotly.NET.StyleParam\nopen Plotly.NET.LayoutObjects\n\nmodule Chart = \n    let myAxis name = LinearAxis.init(Title=Title.init name,Mirror=StyleParam.Mirror.All,Ticks=StyleParam.TickOptions.Inside,ShowGrid=false,ShowLine=true)\n    let withAxisTitles x y chart = \n        chart \n        |\u003E Chart.withTemplate ChartTemplates.lightMirrored\n        |\u003E Chart.withXAxis (myAxis x) \n        |\u003E Chart.withYAxis (myAxis y)\n    \n(**\n# q values\n\n_[Benedikt Venn](https://github.com/bvenn)_, Jan 2022\n\n\n### Table of contents\n\n- [Introduction](#Introduction)\n- [The multiple testing problem](#The-multiple-testing-problem)\n- [False discovery rate](#False-discovery-rate)\n    - [q values](#q-values)\n    - [Variants](#variants)\n- [Quality plots](#Quality-plots)\n- [Definitions and Notes](#Definitions-and-Notes)\n- [References](#References)\n\n## Introduction\n\n\u003Cb\u003EHigh throughput techniques\u003C/b\u003E like microarrays with its successor RNA-Seq and mass spectrometry proteomics lead to an huge data amount.\nThousands of features (e.g. transcripts or proteins) are measured simultaneously. \u003Cb\u003EDifferential expression analysis\u003C/b\u003E aims to identify features, that change significantly\nbetween two conditions. A common experimental setup is the analysis of which genes are over- or underexpressed between e.g. a wild type and a mutant.\n\nHypothesis tests aim to identify differences between two or more samples. The most common statistical test is the \u003Cb\u003Et test\u003C/b\u003E that tests a difference of means. Hypothesis tests report \na p value, that correspond the probability of obtaining results at least as extreme as the observed results, assuming that the null hypothesis is correct. In other words:\n\n\n\n_\u003Ccenter\u003EIf there is no effect (no mean difference), a p value of 0.05 indicates that in 5 % of the tests a false positive is reported.\u003C/center\u003E_\n \n\n\u003Chr\u003E\n\nConsider two population distributions that follow a normal distribution. Both have the \u003Cb\u003Esame\u003C/b\u003E mean and standard deviation.\n*)\n\n\n\nopen FSharpAux\nopen FSharp.Stats\n\nlet distributionA = Distributions.Continuous.normal 10.0 1.0\nlet distributionB = Distributions.Continuous.normal 10.0 1.0\n\n(***hide***)\nlet distributionChartAB = \n    [\n        Chart.Area([5. .. 0.01 .. 15.] |\u003E List.map (fun x -\u003E x,distributionA.PDF x),\u0022distA\u0022)\n        Chart.Area([5. .. 0.01 .. 15.] |\u003E List.map (fun x -\u003E x,distributionB.PDF x),\u0022distB\u0022)\n    ]\n    |\u003E Chart.combine\n    |\u003E Chart.withAxisTitles \u0022variable X\u0022 \u0022relative count\u0022\n    |\u003E Chart.withSize (900.,600.)\n    |\u003E Chart.withTitle \u0022null hypothesis\u0022\n\n(**\u003Ccenter\u003E*)\n(***hide***)\ndistributionChartAB |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\u003C/center\u003E\n\nSamples with sample size 5 are randomly drawn from both population distributions.\nBoth samples are tested \u003Cb\u003Eif a mean difference exist\u003C/b\u003E using a two sample t test where equal variances of the underlying population distribution are assumed.\n\n\n*)\n\nlet getSample n (dist: Distributions.Distribution\u003Cfloat,float\u003E) =\n    Vector.init n (fun _ -\u003E dist.Sample())\n    \nlet sampleA = getSample 5 distributionA\nlet sampleB = getSample 5 distributionB\n\nlet pValue = (Testing.TTest.twoSample true sampleA sampleB).PValue\n\n(***hide***)\npValue\n(***include-it***)\n\n(**\n10,000 tests are performed, each with new randomly drawn samples. This corresponds to an experiment in which \u003Cb\u003Enone of the features changed\u003C/b\u003E \nNote, that the mean intensities are arbitrary and must not be the same for all features! In the presented case all feature intensities are in average 10.\nThe same simulation can be performed with pairwise comparisons from distributions that differ for each feature, but are the same within the feature.\n\u003Cb\u003EThe resulting p values are uniformely distributed between 0 and 1\u003C/b\u003E\n\n\u003Cbr\u003E\n\n\u003Ccenter\u003E\u003Cimg style=\u0022max-width:50%\u0022 src=\u0022../img/qvalue_01.svg\u0022\u003E\u003C/img\u003E\u003C/center\u003E\n\n_Fig 1: p value distribution of the null hypothesis._\n\u003Chr\u003E\n\u003Cbr\u003E\n\n*)\n(***hide***)\nlet nullDist = \n    Array.init 10000 (fun x -\u003E \n        let sA = getSample 5 distributionA\n        let sB = getSample 5 distributionB\n        (Testing.TTest.twoSample true sA sB).PValue\n        )\n\n\nlet nullDistributionChart = \n    nullDist \n    |\u003E Distributions.Frequency.create 0.025 \n    |\u003E Map.toArray \n    |\u003E Array.map (fun (k,c) -\u003E k,float c) \n    |\u003E Chart.StackedColumn \n    |\u003E Chart.withTraceName \u0022alt\u0022\n    |\u003E Chart.withAxisTitles \u0022pvalue\u0022 \u0022frequency\u0022\n\nlet thresholdLine =\n    Shape.init(ShapeType.Line,0.05,0.05,0.,300.)\n\n(**\n\nSamples are called significantly different, if their p value is below a certain significance threshold ($\\alpha$ level). While \u0022the lower the better\u0022, a common threshold\nis a p value of 0.05 or 0.01. In the presented case in average $10,000 * 0.05 = 500$ tests are \u003Cb\u003Esignificant (red box), even though the populations do not differ\u003C/b\u003E. They are called \u003Cb\u003Efalse \npositives (FP)\u003C/b\u003E. Now lets repeat the same experiment, but this time sample 70% of the time from null features (no difference) and \u003Cb\u003Eadd 30% samples of truly \ndiffering\u003C/b\u003E distributions. Therefore a third populations is generated, that differ in mean, but has an equal standard deviation:\n\n*)\n\nlet distributionC = Distributions.Continuous.normal 11.5 1.0\n\n(***hide***)\nlet distributionChartAC = \n    [\n        Chart.Area([5. .. 0.01 .. 15.] |\u003E List.map (fun x -\u003E x,distributionA.PDF x),\u0022distA\u0022)\n        Chart.Area([5. .. 0.01 .. 15.] |\u003E List.map (fun x -\u003E x,distributionC.PDF x),\u0022distC\u0022)\n    ]\n    |\u003E Chart.combine\n    |\u003E Chart.withAxisTitles  \u0022variable X\u0022 \u0022relative count\u0022\n    |\u003E Chart.withSize (1000.,600.)\n    |\u003E Chart.withTitle \u0022alternative hypothesis\u0022\n\n//distributionChartAC |\u003E GenericChart.toChartHTML\n\n(**\n\n\u003Ccenter\u003E\u003Cimg style=\u0022max-width:50%\u0022 src=\u0022../img/qvalue_02.svg\u0022\u003E\u003C/img\u003E\u003C/center\u003E\n\n_Fig 2: p value distribution of the alternative hypothesis. Blue coloring indicate p values deriving from distribution A and B (null). \nOrange coloring indicate p values deriving from distribution A and C (truly differing)._\n\n\nThe pvalue distribution of the tests resulting from truly differing populations are \u003Cb\u003Eright skewed\u003C/b\u003E, while the null tests again show a homogeneous distribution between 0 and 1. \nMany, but not all of the tests that come from the truly differing populations are below 0.05, and therefore would be reported as significant.\nIn average 350 null features would be reported as significant even though they derive from null features (blue bars, 10,000 x 0.7 x 0.05 = 350).\n\n\n##The multiple testing problem\n\nThe hypothesis testing framework with the p value definition given above was \u003Cb\u003Edeveloped for performing just one test. If many tests are performed, like in modern high throuput studies, the probability to obtain a \nfalse positive result increases.\u003C/b\u003E The probability of at least one false positive is called Familywise error rate (FWER) and can be determined by $FWER=1-(1-\\alpha)^m$ where \n$\\alpha$ corresponds to the significance threshold (here 0.05) and $m$ is the number of performed tests.\n\n*)\n\n(***hide***)\n\nlet bonferroniLine = \n    Shape.init(ShapeType.Line,0.,35.,0.05,0.05,Line=Line.init(Dash=DrawingStyle.Dash))\n\nlet fwer = \n    [1..35]\n    |\u003E List.map (fun x -\u003E \n        x,(1. - (1. - 0.05)**(float x))\n        )\n    |\u003E Chart.Point\n    |\u003E Chart.withYAxisStyle(\u0022\u0022,MinMax=(0.,1.))\n    |\u003E Chart.withAxisTitles \u0022#tests\u0022 \u0022p(at least one FP)\u0022 \n    |\u003E Chart.withShape bonferroniLine\n    |\u003E Chart.withTitle \u0022FWER\u0022\n\n(**\u003Ccenter\u003E*)\n(***hide***)\nfwer |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\u003C/center\u003E\n\n_Fig 3: Familiy wise error rate depending on number of performed tests. The black dashed line indicates the Bonferroni corrected FWER by $p^* = \\frac{\\alpha}{m}$ ._\n\n\nWhen 10,000 null features are tested with a p value threshold of 0.05, in average 500 tests are reported significant even if there is not a single comparisons in which the \npopulation differ. **If some of the features are in fact different, the number of false positives consequently decreases (remember, the p value is defined for tests of null features).**\n\nWhy the interpretation of high throughput data based on p values is difficult: The more features are measured, the more false positives you can expect. If 100 differentially \nexpressed genes are identified by p value thresholding, without further information about the magnitude of expected changes and the total number of measured transcripts, the \ndata is useless. \n\nThe p value threshold has no straight-forward interpretation when many tests are performed. Of course you could restrict the family wise error rate to 0.05, regardless \nhow many tests are performed. This is realized by dividing the $\\alpha$ significance threshold by the number of tests, which is known as Bonferroni correction: $p^* = \\frac{\\alpha}{m}$.\nThis correction drastically limit the false positive rate, but in an experiment with a huge count of expected changes, it additionally would result in many false negatives. The \nFWER should be chosen if the costs of follow up studies to tests the candidates are dramatic or there is a huge waste of time to potentially study false positives.\n\n##False discovery rate\n\nA more reasonable measure of significance with a simple interpretation is the so called false discovery rate (FDR). **It describes the rate of expected false positives within the \noverall reported significant features.** The goal is to identify as many sig. features as possible while incurring a relatively low proportion of false positives.\nConsequently a set of reported significant features together with the \u003Cb\u003EFDR describes the confidence of this set\u003C/b\u003E, without the requirement to \nsomehow incorporate the uncertainty that is introduced by the total number of tests performed. In the simulated case of 7,000 null tests and 3,000 tests resulting from truly \ndiffering distributions above, the FDR can be calculated exactly. Therefore at e.g. a p value of 0.05 the number of false positives (blue in red box) are devided by the number \nof significant reported tests (false positives \u002B true positives). \n\n\n\n\n\u003Cbr\u003E\n\u003Chr\u003E\n\n\u003Ccenter\u003E\u003Cimg style=\u0022max-width:75%\u0022 src=\u0022../img/qvalue_03.svg\u0022\u003E\u003C/img\u003E\u003C/center\u003E\n\n_Fig 4: p value distribution of the alternative hypothesis._\n\u003Chr\u003E\n\u003Cbr\u003E\n\nGiven the conditions described in the first chapter, the FDR of this experiment with a p value threshold of 0.05 is 0.173. Out of the 2019 reported significant comparisons, in average 350 \nare expected to be false positives, which gives an straight forward interpretation of the data confidence. In real-world experiments the proportion of null tests and tests \nderiving from an actual difference is of course unknown. **The proportion of null tests however tends to be distributed equally in the p value histogram.** By identification of \nthe average null frequency, a proportion of FP and TP can be determined and the FDR can be defined. This frequency estimate is called $\\pi_0$, which leads to an FDR definition of:\n\n\n\n\u003Cbr\u003E\n\n\n\u003Ccenter\u003E\u003Cimg style=\u0022max-width:75%\u0022 src=\u0022../img/qvalue_04.svg\u0022\u003E\u003C/img\u003E\u003C/center\u003E\n\n_Fig 5: FDR calculation on simulated data._\n\n\u003Cbr\u003E\n\n*)\n\n\n\n(**\n\n\n\n### q values\n\nConsequently for each presented p value a corresponding FDR can be calculated. The minimum local FDR at each p value is called q value. \n\n$$\\hat q(p_i) = min_{t \\geq p_i} \\hat{FDR}(p_i)$$\n\n\nSince the q value is not monotonically increasing, it is smoothed by assigning the lowest FDR of all p values, that are equal or higher the current one.\n\n**By defining $\\pi_0$, all other parameters can be calculated from the given p value distribution to determine the all q values.** The most prominent \nFDR-controlling method is known as Benjamini-Hochberg correction. It sets $\\pi_0$ as 1, assuming that all features are null. In studies with an expected high proportion of true \npositives, a $\\pi_0$ of 1 is too conservative, since there definitely are true positives in the data. \n\nA better estimation of $\\pi_0$ is given in the following:\n\n\u003Cb\u003ETrue positives are assumed to be right skewed while null tests are distributed equally between 0 and 1\u003C/b\u003E. Consequently the right flat region of the p value histogram tends to correspond \nto the true frequency of null comparisons (Fig 5). As \u003Cb\u003Ereal world example\u003C/b\u003E 9856 genes were measured in triplicates under two conditions (control and treatment). The p value distribution of two \nsample t tests looks as follows:\n\n\n*)\n(***hide***)\nlet examplePVals =\n    System.IO.File.ReadAllLines(@\u0022../files/pvalExample.txt\u0022)\n    |\u003E Array.tail\n    |\u003E Array.map float\n\n//number of tests\nlet m =  \n    examplePVals\n    |\u003E Array.length\n    |\u003E float\n\nlet nullLine =\n    Shape.init(ShapeType.Line,0.,1.,1.,1.,Line=Line.init(Dash=DrawingStyle.Dash))\n\nlet empLine =\n    Shape.init(ShapeType.Line,0.,1.,0.4,0.4,Line=Line.init(Dash=DrawingStyle.DashDot,Color=Color.fromHex \u0022#FC3E36\u0022))\n\nlet exampleDistribution = \n    [\n        [\n        examplePVals\n        |\u003E Distributions.Frequency.create 0.025\n        |\u003E Map.toArray \n        |\u003E Array.map (fun (k,c) -\u003E k,float c / (m * 0.025))\n        |\u003E Chart.Column\n        |\u003E Chart.withTraceName \u0022density\u0022\n        |\u003E Chart.withAxisTitles \u0022p value\u0022 \u0022density\u0022\n        |\u003E Chart.withShapes [nullLine;empLine]\n\n        examplePVals\n        |\u003E Distributions.Frequency.create 0.025\n        |\u003E Map.toArray \n        |\u003E Array.map (fun (k,c) -\u003E k,float c)\n        |\u003E Chart.Column\n        |\u003E Chart.withTraceName \u0022gene count\u0022\n        |\u003E Chart.withAxisTitles \u0022p value\u0022 \u0022gene count\u0022\n        ]\n    ]\n    |\u003E Chart.Grid()\n    |\u003E Chart.withSize(1100.,550.)\n\n(**\u003Ccenter\u003E*)\n(***hide***)\nexampleDistribution |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\u003C/center\u003E\n\n_Fig 6: p value distributions of real world example. The frequency is given on the right, its density on the left. The black dashed line indicates the distribution, if all features\nwere null. The red dash-dotted line indicates the visual estimated pi0._\n\n\u003Cbr\u003E\n\u003Chr\u003E\n\n\n\nBy performing t tests for all comparisons 3743 (38 %) of the genes lead to a pvalue lower than 0.05.\nBy eye, you would estimate $\\pi_0$ as 0.4, indicating, only a small fraction of the genes are unaltered (null). After q value calculations, you would filter for a specific FDR (e.g. 0.05) and \nend up with an p value threshold of 0.04613, indicating a FDR of max. 0.05 in the final reported 3642 genes. \n\n\u0060\u0060\u0060no-highlight\npi0     = 0.4\nm       = 9856\nD(p)    = number of sig. tests at given p\nFP(p)   = p*0.4*9856\nFDR(p)  = FP(p) / D(p)\n\u0060\u0060\u0060\n\nFDR(0.04613) = 0.4995 \n\n\n\n\u003Cbr\u003E\n\u003Chr\u003E\n\n*)\n(***hide***)\nlet pi0 = 0.4\n\nlet getD p = \n    examplePVals \n    |\u003E Array.sumBy (fun x -\u003E if x \u003C= p then 1. else 0.) \n\nlet getFP p = p * pi0 * m\n\nlet getFDR p = (getFP p) / (getD p)\n\nlet qvaluesNotSmoothed = \n    examplePVals\n    |\u003E Array.sort\n    |\u003E Array.map (fun x -\u003E \n        x, getFDR x)\n    |\u003E Chart.Line \n    |\u003E Chart.withTraceName \u0022not smoothed\u0022\nlet qvaluesSmoothed = \n    let pValsSorted =\n        examplePVals\n        |\u003E Array.sortDescending\n    let rec loop i lowest acc  = \n        if i = pValsSorted.Length then \n            acc |\u003E List.rev\n        else \n            let p = pValsSorted.[i]\n            let q = getFDR p\n            if q \u003E lowest then  \n                loop (i\u002B1) lowest ((p,lowest)::acc)\n            else loop (i\u002B1) q ((p,q)::acc)\n    loop 0 1. []\n    |\u003E Chart.Line\n    |\u003E Chart.withTraceName \u0022smoothed\u0022\nlet eXpos = examplePVals |\u003E Array.filter (fun x -\u003E x \u003C= 0.046135) |\u003E Array.length\nlet p2qValeChart =\n    [qvaluesNotSmoothed;qvaluesSmoothed]\n    |\u003E Chart.combine\n    |\u003E Chart.withYAxisStyle(\u0022\u0022,MinMax=(0.,1.))\n    |\u003E Chart.withAxisTitles \u0022p value\u0022 \u0022q value\u0022\n    |\u003E Chart.withShape empLine\n    |\u003E Chart.withTitle (sprintf \u0022#[genes with q value \u003C 0.05] = %i\u0022 eXpos)\n\n(**\u003Ccenter\u003E*)\n(***hide***)\np2qValeChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\u003C/center\u003E\n\n_Fig 7: FDR calculation on experiment data. Please zoom into the very first part of the curve to inspect the monotonicity._\n\u003Chr\u003E\n\n\n\n###The automatic detection of $\\pi_0$ is facilitated as follows\n\n\nFor a range of $\\lambda$ in e.g. $\\{0.0  ..  0.05  ..  0.95\\}$, calculate $\\hat \\pi_0 (\\lambda) = \\frac {\\#[p_j \u003E \\lambda]}{m(1 - \\lambda)}$\n\n*)\n\n\nlet pi0Est = \n    [|0. .. 0.05 .. 0.95|]\n    |\u003E Array.map (fun lambda -\u003E \n        let num = \n            examplePVals \n            |\u003E Array.sumBy (fun x -\u003E if x \u003E lambda then 1. else 0.) \n        let den = float examplePVals.Length * (1. - lambda)\n        lambda, num/den\n        )\n\n(***hide***)\nlet pi0EstChart = \n    pi0Est \n    |\u003E Chart.Point\n    |\u003E Chart.withYAxisStyle(\u0022\u0022,MinMax=(0.,1.))\n    |\u003E Chart.withXAxisStyle(\u0022\u0022,MinMax=(0.,1.))\n    |\u003E Chart.withAxisTitles \u0022$\\lambda$\u0022 \u0022$\\hat \\pi_0(\\lambda)$\u0022\n    |\u003E Chart.withMathTex(true)\n    |\u003E Chart.withConfig(\n        Config.init(\n            Responsive=true, \n            ModeBarButtonsToAdd=[\n                ModeBarButton.DrawLine\n                ModeBarButton.DrawOpenPath\n                ModeBarButton.EraseShape\n                ]\n            )\n        )\n\n(**\u003Ccenter\u003E*)\n(***hide***)\npi0EstChart|\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\u003C/center\u003E\n\n_Fig 8: pi0 estimation._\n\u003Chr\u003E\n\nThe resulting diagram shows, that with increasing $\\lambda$ its function value $\\hat \\pi_0(\\lambda)$ tends to $\\pi_0$. The calculation \u003Cb\u003Erelates the actual proportion of tests greater than $\\lambda$ to the proportion of $\\lambda$ range the corresponding p values are in\u003C/b\u003E.\nIn Storey \u0026 Tibshirani 2003 this curve is fitted with a \u003Cb\u003Ecubic spline\u003C/b\u003E. A weighting of the knots by $(1 - \\lambda)$ is recommended \nbut not specified in the final publication. Afterwards the function value at $\\hat \\pi_0(1)$ is defined as final estimator of $\\pi_0$. This is often referred to as the _smoother method_.\n\nAnother method (_bootstrap method_) (Storey et al., 2004), that does not depend on fitting is based on \u003Cb\u003Ebootstrapping\u003C/b\u003E and was introduced in Storey et al. (2004). It is implemented in FSharp.Stats:\n\n  1. Determine the minimal $\\hat \\pi_0 (\\lambda)$ and call it $min \\hat \\pi_0$ . \n\n  2. For each $\\lambda$, bootstrap the p values (e.g. 100 times) and calculate the mean squared error (MSE) from the difference of resulting $\\hat \\pi_0^b$ to $min  \\hat \\pi_0$. The minimal MSE indicates the best $\\lambda$. With $\\lambda$ \ndefined, $\\pi_0$ can be determined. \u003Cb\u003ENote: When bootstrapping an data set of size n, n elements are drawn with replacement.\u003C/b\u003E\n\n\n\n*)\n\n\n(***hide***)\nlet getpi0Bootstrap (lambda:float[]) (pValues:float[]) =\n    let rnd = System.Random()\n    let m = pValues.Length |\u003E float\n    let getpi0hat lambda pVals=\n        let hits = \n            pVals \n            |\u003E Array.sumBy (fun x -\u003E if x \u003E lambda then 1. else 0.) \n        hits / (m * (1. - lambda))\n    \n    //calculate MSE for each lambda\n    let getMSE lambda =\n        let mse = \n            //generate 100 bootstrap samples of p values and calculate the MSE at given lambda\n            Array.init 100 (fun b -\u003E \n                Array.sampleWithReplacement rnd pValues pValues.Length  \n                |\u003E getpi0hat lambda\n                )\n        mse\n    lambda\n    |\u003E Array.map (fun l -\u003E l,getMSE l)\n    \n\nlet minimalpihat = \n    //FSharp.Stats.Testing.MultipleTesting.Qvalues.pi0hats  [|0. .. 0.05 .. 0.96|] examplePVals |\u003E Array.minBy snd |\u003E snd\n    0.3686417749\n\nlet minpiHatShape = \n    Shape.init(ShapeType.Line,0.,1.,minimalpihat,minimalpihat,Line=Line.init(Dash=DrawingStyle.Dash))\n\nlet bootstrappedPi0 =\n    getpi0Bootstrap [|0. .. 0.05 .. 0.95|] examplePVals\n    |\u003E Array.map (fun (l,x) -\u003E \n        Chart.BoxPlot(x=Array.init x.Length (fun _ -\u003E l),y=x,Fillcolor=Color.fromHex\u0022#1F77B4\u0022,MarkerColor=Color.fromHex\u0022#1F77B4\u0022,Name=sprintf \u0022%.2f\u0022 l))\n    |\u003E Chart.combine\n    |\u003E Chart.withYAxisStyle(\u0022\u0022,MinMax=(0.,1.))\n    |\u003E Chart.withAxisTitles \u0022$\\lambda$\u0022 \u0022$\\hat \\pi_0$\u0022\n    |\u003E Chart.withMathTex(true)\n    |\u003E Chart.withShape minpiHatShape\n    |\u003E Chart.withConfig(\n        Config.init(\n            Responsive=true, \n            ModeBarButtonsToAdd=[\n                ModeBarButton.DrawLine\n                ModeBarButton.DrawOpenPath\n                ModeBarButton.EraseShape\n                ]\n            )\n        )\n\nbootstrappedPi0 |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n\n(**\n\n\n_Fig 9: Bootstrapping for pi0 estimation. The dashed line indicates the minimal pi0 from Fig. 8.\nThe bootstrapped pi0 distribution that shows the least variation to the dashed line is the optimal. In the presented example it is either 0.8 or 0.85._\n\u003Chr\u003E\n\nFor an $\\lambda$, range of $\\{0.0  ..  0.05  ..  0.95\\}$ the bootstrapping method determines either 0.8 or 0.85 as optimal $\\lambda$ and therefore $optimal  \\hat \\pi_0$ is either $0.3703$ or $0.3686$.\n\nThe \u003Cb\u003Eautomated estimation\u003C/b\u003E of $\\pi_0$ based on bootstrapping is implemented in \u0060FSharp.Stats.Testing.MultipleTesting.Qvalues\u0060.\n\n*)\nopen Testing.MultipleTesting\n\nlet pi0Stats = Qvalues.pi0BootstrapWithLambda [|0.0 .. 0.05 .. 0.95|] examplePVals\n\n(***hide***)\npi0Stats\n(***include-it***)\n\n\n\n\n(**\nSubsequent to $\\pi_0$ estimation the \u003Cb\u003Eq values can be determined\u003C/b\u003E from a list of p values.\n*)\n\nlet qValues = Qvalues.ofPValues pi0Stats examplePVals\n\n(***hide***)\nqValues\n(***include-it***)\n\n(**\n###Variants\n\nA robust variant of q value determination exists, that is more conservative for small p values when\nthe total number of p values is low. Here the number of false positives is divided by the number of \ntotal discoveries multiplied by the FWER at the current p value. The correction takes into account \nthe probability of a false positive being reported in the first place.\n\nEspecially when the population distributions do not follow a perfect normal distribution or the p value distribution looks strange, \nthe usage of the robust version is recommended.\n\n\u003Ccenter\u003E\n\n$qval = {\\#FP \\over \\#Discoveries}$ \n\n$qval_{robust} = {\\#FP \\over \\#Discoveries \\times (1-(1-p)^m)}$ \n\n\u003C/center\u003E\n\n*)\n\nlet qvaluesRobust = \n    Testing.MultipleTesting.Qvalues.ofPValuesRobust pi0Stats examplePVals\n\n(***hide***)\n\n\nlet qChart =    \n    [\n        Chart.Line(Array.sortBy fst (Array.zip examplePVals qValues),Name=\u0022qValue\u0022)\n        Chart.Line(Array.sortBy fst (Array.zip examplePVals qvaluesRobust),Name=\u0022qValueRobust\u0022)\n    ]\n    |\u003E Chart.combine\n    |\u003E Chart.withAxisTitles \u0022p value\u0022 \u0022q value\u0022\n\nqChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 10: Comparison of q values and robust q values, that is more conservative at low p values._\n\n\n##Quality plots\n\n*)\n\nlet pi0Line = \n    Shape.init(ShapeType.Line,0.,1.,pi0Stats,pi0Stats,Line=Line.init(Dash=DrawingStyle.Dash))\n\n// relates the q value to each p value\nlet p2q = \n    Array.zip examplePVals qValues\n    |\u003E Array.sortBy fst\n    |\u003E Chart.Line\n    |\u003E Chart.withShape pi0Line\n    |\u003E Chart.withAxisTitles \u0022p value\u0022 \u0022q value\u0022\n\n// shows the p values distribution for an visual inspection of pi0 estimation\nlet pValueDistribution =\n    let frequencyBins = 0.025 \n    let m = examplePVals.Length |\u003E float\n    examplePVals \n    |\u003E Distributions.Frequency.create frequencyBins \n    |\u003E Map.toArray \n    |\u003E Array.map (fun (k,c) -\u003E k,float c / frequencyBins / m) \n    |\u003E Chart.StackedColumn \n    |\u003E Chart.withTraceName \u0022p values\u0022\n    |\u003E Chart.withAxisTitles \u0022p value\u0022 \u0022frequency density\u0022\n    |\u003E Chart.withShape pi0Line\n\n// shows pi0 estimation in relation to lambda\nlet pi0Estimation = \n    //Testing.MultipleTesting.Qvalues.pi0hats [|0. .. 0.05 .. 0.96|] examplePVals\n    [|0. .. 0.05 .. 0.95|]\n    |\u003E Array.map (fun lambda -\u003E \n        let num =   \n            examplePVals \n            |\u003E Array.sumBy (fun x -\u003E if x \u003E lambda then 1. else 0.)\n        let den = float examplePVals.Length * (1. - lambda)\n        lambda, num/den\n        )\n    |\u003E Chart.Point\n    |\u003E Chart.withAxisTitles \u0022$\\lambda$\u0022 \u0022$\\hat \\pi_0(\\lambda)$\u0022\n    |\u003E Chart.withMathTex(true)\n\n\n(***hide***)\n//System.IO.File.ReadAllText \u0022../img/qvalue_fig10.html\u0022\np2q |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 11: p value relation to q values. At a p value of 1 the q value is equal to pi0 (black dashed line)._\n*)\n\n(***hide***)\npValueDistribution |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 12: p value density distribution. The dashed line indicates pi0 estimated by Storeys bootstrapping method._\n*)\n\n(***hide***)\npi0Estimation|\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n_Fig 13: Visual pi0 estimation._\n*)\n\n(**\n##Definitions and Notes\n  - Benjamini-Hochberg (BH) correction is equal to q values with $\\pi_0 = 1$\n  - Storey \u0026 Tibshirani (2003):\n    - _\u0022The 0.05 q-value cut-off is arbitrary, and we do not recommend that this value necessarily be used.\u0022_\n    - _\u0022The q-value for a particular feature is the expected proportion of false positives occurring up through that feature on the list.\u0022_\n    - _\u0022The precise definition of the q-value for a particular feature is the following. The q-value for a particular feature is the minimum false discovery rate that can be attained when calling all features up through that one on the list significant.\u0022_\n    - _\u0022The Benjamini \u0026 Hochberg (1995) methodology also forces one to choose an acceptable FDR level before any data are seen, which is often going to be impractical.\u0022_\n  - To improve the q value estimation if the effects are asymmetric, meaning that negative effects are stronger than positives, or vice versa a method was published in 2014 by Orr et al.. They estimate a global $m_0$ and then split the p values \n  in two groups before calulating q values for each p value set. The applicability of this strategy however is questionable, as the number of up- and downregulated features must be equal, which is not the case in most biological experimental setups.\n  - The distinction of FDR and pFDR (positive FDR) is not crucial in the presented context, because in high throughput experiments with m\u003E\u003E100: Pr(R \u003E 0) ~ 1 (Storey \u0026 Tibshirani, 2003, Appendix Remark A).\n  - The local FDR (lFDR) is sometimes referred to as the probability that for the current p value the null hypothesis is true (Storey 2011).\n  - If you have found typos, errors, or misleading statements, please feel free to file a pull request or contact me.\n\n\n##FAQ\n  - Why are q values lower than their associated p values?\n    - q values are not necessarily greater than their associated p values. q values can maximal be pi0. The definition of p values ist not the same as for q values! A q\n    value defines what proportion of the reported discoveries may be false.\n\n  - Which cut off should I use?\n    - _\u0022The 0.05 q-value cut-off is arbitrary, and we do not recommend that this value necessarily be used.\u0022_ (Storey 2003). It depends on your experimental design and the number of false positives you are willing to accept.\n    If there are _20 discoveries_, you may argue to accept if _2_ of them are false positives (FDR=0.1). On the other hand, if there are _10,000 discoveries_ with _1,000 false positives_ (FDR=0.1) you may should reduce the FDR. Thereby the \n    proportion of false positives decreases. Of course in this case the number of positives will decrease as well. It all breaks down to the matter of willingness to accept a certain number of false positives within your study. \n    Studies, that aim to identify the presence of an specific protein of interest, the FDR should be kept low, because it inflates the risk, that this particular candidate is a false positive.\n    If confirmatory follow up studies are cheap, you can increase the FDR, if they are **expensive**, you should restrict the number of false positives to **avoid unpleasant discussions with your supervisor**. \n    \n  - In my study gene RBCM has an q value of 0.03. Does that indicate, there is a 3% chance, that it is an false positive?\n    - No, actually the change that this particulare gene is an false positive may actually be higher, because there may be genes that are much more significant than MSH2. The q value indicates, \n    that 3% of the genes that are as or more extreme than RBCM are false positives (Storey 2003).\n\n  - Should I use the default or robust version for my study?\n\n  - When should I use q values over BH correction, or other multiple testing variants?\n    - There is no straight forward answer to this question. If you are able to define a confident pi0 estimate by eye when inspecting the p value distribution, then the q value approach may be feasable.\n    If you struggle in defining pi0, because the p value distribution has an odd shape or there are too few p values on which you base your estimate, it is better to choose the more conservative BH correction, or even\n    consider other methodologies.\n\n##References\n  - Storey JD, Tibshirani R, Statistical significance for genomewide studies, 2003 [DOI: 10.1073/pnas.1530509100](https://www.pnas.org/content/100/16/9440)\n  - Storey JD, Taylor JE, Siegmund D, Strong Control, Conservative Point Estimation and Simultaneous Conservative Consistency of False Discovery Rates: A Unified Approach, 2004, [http://www.jstor.org/stable/3647634](https://www.jstor.org/stable/3647634?seq=1#metadata_info_tab_contents).\n  - Storey JD, Princeton University, 2011, [preprint](http://genomics.princeton.edu/storeylab/papers/Storey_FDR_2011.pdf)\n  - Orr M, Liu P, Nettleton D, An improved method for computing q-values when the distribution of effect sizes is asymmetric, 2014, [doi: 10.1093/bioinformatics/btu432](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4609005/)\n  - NettletonD et al., Estimating the Number of True Null Hypotheses from a Histogram of p Values., 2006, http://www.jstor.org/stable/27595607.\n  - Benjamini Y, Hochberg Y, On the Adaptive Control of the False Discovery Rate in Multiple Testing With Independent Statistics, 2000, [doi:10.3102/10769986025001060](https://journals.sagepub.com/doi/10.3102/10769986025001060)\n\n*)"},{"uri":"/CSBlog/posts/about.html","title":"About","content":"---\r\ntitle: About\r\ncategory: Overview\r\ncategoryindex: 0\r\nindex: 0\r\n---\r\n\r\n# About this Blog\r\n\r\nThe CSBlog is the official blog of the Computational Systems Biology workgroup at the TU Kaiserslautern. \r\n\r\nWe are a relatively young workgroup, with Jun. Prof. Dr. Timo Muehlhaus being the head of the group. Besides research, creating a functional library including a broad range of computational tools written in F# is one of our major interests. The set of libraries can be viewed and accessed on [GitHub](https://github.com/CSBiology).\r\n\r\n## Maintainers\r\nHeinrich Lukas Weil  \r\nContact: hl.weil@t-online.de  \r\nGitHub: https://github.com/HLWeil\r\n\r\nKevin Schneider  \r\nContact: kevin-schneider@mutagene.de  \r\nGitHub: https://github.com/kMutagene\r\n\r\n## Technical Information about this Blog\r\nThe current version was set up using [FSharp.Formatting](https://github.com/fsprojects/FSharp.Formatting).\r\nThe style of the Website is based on a customized version of [Bulma](https://github.com/CSBiology/CSBlog/blob/main/docs/content/fsdocs-custom.css)."},{"uri":"/CSBlog/posts/blogposts_overview.html","title":"BlogPosts","content":"---\r\ntitle: BlogPosts\r\ncategory: Overview\r\ncategoryindex: 0\r\nindex: 1\r\n---\r\n\r\n# BlogPosts\r\n\r\nThis is a chronological overview over every published BlogPost on this page.  \r\nThe BlogPosts themselves have categories which they are assigned to. The corresponding category is listed on the sidebar.\r\n\r\n* February 1, 2017: [Creating a Documentation](..\\posts\\documentation.html) (by [Heinrich Lukas Weil](https://github.com/HLWeil))\r\n* February 8, 2019: [Introduction to Data visualization using Plotly.NET](..\\posts\\WorkshopSeries_3_plotly.html) (by [Kevin Schneider](https://github.com/kMutagene))\r\n* September 3, 2021: [How to develop and use a JSON Schema](..\\posts\\0_how2JSONSchema.html) (by [Oliver Maus](https://github.com/omaus))\r\n* October 1, 2021: [Hot to use Fable](../posts/1_how2Fable.html) (by [Kevin Frey](https://github.com/Freymaurer))\r\n\r\n# CSBar Reports\r\n\r\nA chronological list about every CSBar Report published:\r\n\r\n1. [December 15, 2018](../posts/CoffeeReport1.html)"},{"uri":"/CSBlog/posts/CoffeeReport1.html","title":"CSBar Report 1","content":"(**\n\n---\ntitle: CSBar Report 1\ncategory: CSBar Reports\ncategoryindex: 100\nindex: 0\n---\n\n*)\n\n(**\n\u003Cscript src=\u0022https://cdn.plot.ly/plotly-latest.min.js\u0022\u003E\u003C/script\u003E\u003Cstyle id=\u0022plotly.js-style-global\u0022\u003E\u003C/style\u003E\n*)\n\n(*** hide ***)\n\n#r \u0022nuget: Plotly.NET, 2.0.0-beta5\u0022\nopen Plotly.NET\n\n(**\n# CSBar Report 1\n_[Kevin Schneider](https://github.com/kMutagene)_\n\n## Welcome to the first CSBar report! \nAs you all know, our CSBar ticking system went live a few weeks ago.\nNow that we sent out the first balance notifications, I decided that it\u0027s a good time to write the very first report and share an analysis of the coffe/beer/beverage consumption with you.\n\nBut first, I want to thank everyone participating. A whooping 100 % of coffees registered by the coffee machine have actually been ticked with our system, thanks for your patience during beta and your honesty.\n\nI divided the analysis in 3 parts:\n\n 1. [Summary Stats](#Summary-stats) \uFFFD A summary of the time course of coffee, beer and beverage consumption and their fraction of the total consumption\n 2. [Consumption Stats](#Consumption-stats) \uFFFD Distributions of coffee, beer and beverage consumption over teams and the whole CSBar population\n 3. [Distance Stats](#Distance-stats) \uFFFD An analysis of the distances teams and their members traveled to get coffee\n\nAnalysis and plots where done by using the toolkits we develop. Feel free to take a look at our libraries at [Github](https://github.com/CSBiology), they are all open source and free to use.\nAll the charts are interactive, meaning you can zoom in/out etc.\n\n## Summary stats\n\n### Time course of consumption\nThe overall timecourse of the respective consumptions so far is not too suprising.\nCoffee consumption is high during all weekdays and almost not present on weekends. Interestingly, there always seems to be somebody working in the building at weekends who needs a nice cup of coffee to get work done.\nBeer consumption seems to be the highest on wednesdays (Bergfest!) and especially on fridays (weekend is coming, yay!). There also seem to be no parties in the social room at weekends, at least not with CSBar beer.\nBeverage consumption peeks at Aug 28th, and the low consumption afterwards may be due to the missing afri cola, which was very delicious.  \n\n\u003Cdiv id=\u0022e075b67b-a726-4a55-a26c-4be921c46433\u0022 style=\u0022width: 1000px; height: 750px;\u0022\u003E\u003C!-- Plotly chart will be drawn inside this DIV --\u003E\u003C/div\u003E        \n\u003Cscript\u003E\n  var data = [{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u00222018-08-17T00:00:00\u0022,\u00222018-08-18T00:00:00\u0022,\u00222018-08-19T00:00:00\u0022,\u00222018-08-20T00:00:00\u0022,\u00222018-08-21T00:00:00\u0022,\u00222018-08-22T00:00:00\u0022,\u00222018-08-23T00:00:00\u0022,\u00222018-08-24T00:00:00\u0022,\u00222018-08-25T00:00:00\u0022,\u00222018-08-26T00:00:00\u0022,\u00222018-08-27T00:00:00\u0022,\u00222018-08-28T00:00:00\u0022,\u00222018-08-29T00:00:00\u0022,\u00222018-08-30T00:00:00\u0022,\u00222018-08-31T00:00:00\u0022,\u00222018-09-01T00:00:00\u0022,\u00222018-09-02T00:00:00\u0022,\u00222018-09-03T00:00:00\u0022,\u00222018-09-04T00:00:00\u0022],\u0022y\u0022:[0,1,0,18,13,9,29,23,1,2,23,31,32,20,19,1,0,24,14],\u0022marker\u0022:{},\u0022name\u0022:\u0022CoffeeConsumption\u0022,\u0022xaxis\u0022:\u0022x\u0022,\u0022yaxis\u0022:\u0022y\u0022},{\u0022type\u0022:\u0022scatter\u0022,\u0022x\u0022:[\u00222018-08-17T00:00:00\u0022,\u00222018-08-18T00:00:00\u0022,\u00222018-08-19T00:00:00\u0022,\u00222018-08-20T00:00:00\u0022,\u00222018-08-21T00:00:00\u0022,\u00222018-08-22T00:00:00\u0022,\u00222018-08-23T00:00:00\u0022,\u00222018-08-24T00:00:00\u0022,\u00222018-08-25T00:00:00\u0022,\u00222018-08-26T00:00:00\u0022,\u00222018-08-27T00:00:00\u0022,\u00222018-08-28T00:00:00\u0022,\u00222018-08-29T00:00:00\u0022,\u00222018-08-30T00:00:00\u0022,\u00222018-08-31T00:00:00\u0022,\u00222018-09-01T00:00:00\u0022,\u00222018-09-02T00:00:00\u0022,\u00222018-09-03T00:00:00\u0022,\u00222018-09-04T00:00:00\u0022],\u0022y\u0022:[0,1,0,18,13,9,29,23,1,2,23,31,32,20,19,1,0,24,14],\u0022mode\u0022:\u0022lines\u0022,\u0022fill\u0022:\u0022tozeroy\u0022,\u0022name\u0022:\u0022 \u0022,\u0022line\u0022:{\u0022width\u0022:{},\u0022color\u0022:\u0022blue\u0022,\u0022shape\u0022:\u0022spline\u0022,\u0022smoothing\u0022:100,\u0022dash\u0022:\u0022dash\u0022},\u0022marker\u0022:{\u0022color\u0022:\u0022blue\u0022},\u0022xaxis\u0022:\u0022x\u0022,\u0022yaxis\u0022:\u0022y\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u00222018-08-17T00:00:00\u0022,\u00222018-08-18T00:00:00\u0022,\u00222018-08-19T00:00:00\u0022,\u00222018-08-20T00:00:00\u0022,\u00222018-08-21T00:00:00\u0022,\u00222018-08-22T00:00:00\u0022,\u00222018-08-23T00:00:00\u0022,\u00222018-08-24T00:00:00\u0022,\u00222018-08-25T00:00:00\u0022,\u00222018-08-26T00:00:00\u0022,\u00222018-08-27T00:00:00\u0022,\u00222018-08-28T00:00:00\u0022,\u00222018-08-29T00:00:00\u0022,\u00222018-08-30T00:00:00\u0022,\u00222018-08-31T00:00:00\u0022,\u00222018-09-01T00:00:00\u0022,\u00222018-09-02T00:00:00\u0022,\u00222018-09-03T00:00:00\u0022,\u00222018-09-04T00:00:00\u0022],\u0022y\u0022:[5,1,0,1,4,6,4,10,0,0,4,6,4,0,3,0,0,5,0],\u0022marker\u0022:{\u0022color\u0022:\u0022rgb(246, 126, 0)\u0022},\u0022name\u0022:\u0022BeerConsumption\u0022,\u0022xaxis\u0022:\u0022x2\u0022,\u0022yaxis\u0022:\u0022y2\u0022},{\u0022type\u0022:\u0022scatter\u0022,\u0022x\u0022:[\u00222018-08-17T00:00:00\u0022,\u00222018-08-18T00:00:00\u0022,\u00222018-08-19T00:00:00\u0022,\u00222018-08-20T00:00:00\u0022,\u00222018-08-21T00:00:00\u0022,\u00222018-08-22T00:00:00\u0022,\u00222018-08-23T00:00:00\u0022,\u00222018-08-24T00:00:00\u0022,\u00222018-08-25T00:00:00\u0022,\u00222018-08-26T00:00:00\u0022,\u00222018-08-27T00:00:00\u0022,\u00222018-08-28T00:00:00\u0022,\u00222018-08-29T00:00:00\u0022,\u00222018-08-30T00:00:00\u0022,\u00222018-08-31T00:00:00\u0022,\u00222018-09-01T00:00:00\u0022,\u00222018-09-02T00:00:00\u0022,\u00222018-09-03T00:00:00\u0022,\u00222018-09-04T00:00:00\u0022],\u0022y\u0022:[5,1,0,1,4,6,4,10,0,0,4,6,4,0,3,0,0,5,0],\u0022mode\u0022:\u0022lines\u0022,\u0022fill\u0022:\u0022tozeroy\u0022,\u0022name\u0022:\u0022 \u0022,\u0022line\u0022:{\u0022width\u0022:{},\u0022color\u0022:\u0022orange\u0022,\u0022shape\u0022:\u0022spline\u0022,\u0022smoothing\u0022:100,\u0022dash\u0022:\u0022dash\u0022},\u0022marker\u0022:{\u0022color\u0022:\u0022orange\u0022},\u0022xaxis\u0022:\u0022x2\u0022,\u0022yaxis\u0022:\u0022y2\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u00222018-08-17T00:00:00\u0022,\u00222018-08-18T00:00:00\u0022,\u00222018-08-19T00:00:00\u0022,\u00222018-08-20T00:00:00\u0022,\u00222018-08-21T00:00:00\u0022,\u00222018-08-22T00:00:00\u0022,\u00222018-08-23T00:00:00\u0022,\u00222018-08-24T00:00:00\u0022,\u00222018-08-25T00:00:00\u0022,\u00222018-08-26T00:00:00\u0022,\u00222018-08-27T00:00:00\u0022,\u00222018-08-28T00:00:00\u0022,\u00222018-08-29T00:00:00\u0022,\u00222018-08-30T00:00:00\u0022,\u00222018-08-31T00:00:00\u0022,\u00222018-09-01T00:00:00\u0022,\u00222018-09-02T00:00:00\u0022,\u00222018-09-03T00:00:00\u0022,\u00222018-09-04T00:00:00\u0022],\u0022y\u0022:[0,0,0,3,2,5,6,3,1,0,0,7,2,0,2,1,0,0,0],\u0022marker\u0022:{\u0022color\u0022:\u0022rgb(65, 160, 33)\u0022},\u0022name\u0022:\u0022BeverageConsumption\u0022,\u0022xaxis\u0022:\u0022x3\u0022,\u0022yaxis\u0022:\u0022y3\u0022},{\u0022type\u0022:\u0022scatter\u0022,\u0022x\u0022:[\u00222018-08-17T00:00:00\u0022,\u00222018-08-18T00:00:00\u0022,\u00222018-08-19T00:00:00\u0022,\u00222018-08-20T00:00:00\u0022,\u00222018-08-21T00:00:00\u0022,\u00222018-08-22T00:00:00\u0022,\u00222018-08-23T00:00:00\u0022,\u00222018-08-24T00:00:00\u0022,\u00222018-08-25T00:00:00\u0022,\u00222018-08-26T00:00:00\u0022,\u00222018-08-27T00:00:00\u0022,\u00222018-08-28T00:00:00\u0022,\u00222018-08-29T00:00:00\u0022,\u00222018-08-30T00:00:00\u0022,\u00222018-08-31T00:00:00\u0022,\u00222018-09-01T00:00:00\u0022,\u00222018-09-02T00:00:00\u0022,\u00222018-09-03T00:00:00\u0022,\u00222018-09-04T00:00:00\u0022],\u0022y\u0022:[0,0,0,3,2,5,6,3,1,0,0,7,2,0,2,1,0,0,0],\u0022mode\u0022:\u0022lines\u0022,\u0022fill\u0022:\u0022tozeroy\u0022,\u0022name\u0022:\u0022 \u0022,\u0022line\u0022:{\u0022width\u0022:{},\u0022color\u0022:\u0022green\u0022,\u0022shape\u0022:\u0022spline\u0022,\u0022smoothing\u0022:100,\u0022dash\u0022:\u0022dash\u0022},\u0022marker\u0022:{\u0022color\u0022:\u0022green\u0022},\u0022xaxis\u0022:\u0022x3\u0022,\u0022yaxis\u0022:\u0022y3\u0022}];\n  var layout = {\u0022yaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [cups]\u0022,\u0022range\u0022:[0.0,33.0],\u0022anchor\u0022:\u0022x\u0022,\u0022domain\u0022:[0.71666666666666667,1.0]},\u0022xaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [huelsen]\u0022,\u0022range\u0022:[0.0,33.0],\u0022anchor\u0022:\u0022x2\u0022,\u0022domain\u0022:[0.38333333333333341,0.66666666666666674]},\u0022xaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y2\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis3\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [bottles]\u0022,\u0022range\u0022:[0.0,33.0],\u0022anchor\u0022:\u0022x3\u0022,\u0022domain\u0022:[0.050000000000000044,0.33333333333333337]},\u0022xaxis3\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y3\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022width\u0022:1000.0,\u0022height\u0022:750.0};\n  Plotly.newPlot(\u0027e075b67b-a726-4a55-a26c-4be921c46433\u0027, data, layout);\n\u003C/script\u003E  \n\n### Fractions\nThe total consumption consists of the following fractions:\n\n * 260 coffees\n * 53 beers \n * 32 other beverages.  \n \n\u003Cdiv class=\u0022PlotlyChart\u0022 id=\u0022366cabba-b467-4f10-b2de-2c5992d6980c\u0022 style=\u0022width: 600px; height: 600px;\u0022\u003E\u003C!-- Plotly chart will be drawn inside this DIV --\u003E\u003C/div\u003E        \n\u003Cscript\u003E\n  var data = [{\u0022type\u0022:\u0022pie\u0022,\u0022values\u0022:[260,32,53],\u0022labels\u0022:[\u0022Coffee\u0022,\u0022Beverages\u0022,\u0022Beer\u0022],\u0022marker\u0022:{},\u0022text\u0022:[\u0022Coffee\u0022,\u0022Beverages\u0022,\u0022Beer\u0022]}];\n  var layout = {};\n  Plotly.newPlot(\u0027366cabba-b467-4f10-b2de-2c5992d6980c\u0027, data, layout);\n\u003C/script\u003E  \n\n## Consumption stats\n\n### Distribution by team\nCoffee consumption is by far the highest in the ITCrowd team. This may be due to the widely accepted rule that liquid coffee can be directly converted to code by our bodies using a pathway called \u0022I will stay until this code works\u0022. Or maybe some caffeine addiction problems. Your call.\n\nThe team with the next lower coffee consumption is the Mibis team. This is not surprising since ITCrowd and Mibis used the coffee machine together way before the move to the new building.\n\nThe low coffee consumption of the other teams could be explayined by them either primarily using their own coffee machines or not all team members knowing about the system yet.\nHowever, the beer consumption of some of these teams points more to the former than the latter.\n\nITCrowd is also the top dog of other beverage consumption (did I mention that I like afri cola?)  \n\n\u003Cdiv class=\u0022PlotlyChart\u0022 id=\u00228b2201a7-8f55-4bf6-8fbf-5956967303bc\u0022 style=\u0022width: 1000px; height: 750px;\u0022\u003E\u003C!-- Plotly chart will be drawn inside this DIV --\u003E\u003C/div\u003E        \n\u003Cscript\u003E\n  var data = [{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u0022Fungis\u0022,\u0022ITCrowd\u0022,\u0022Mibis\u0022,\u0022hotOrNot\u0022,\u0022Ribos\u0022],\u0022y\u0022:[4,169,71,14,6],\u0022marker\u0022:{},\u0022name\u0022:\u0022CoffeeConsumption\u0022,\u0022showlegend\u0022:true,\u0022textposition\u0022:\u0022top right\u0022,\u0022xaxis\u0022:\u0022x\u0022,\u0022yaxis\u0022:\u0022y\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u0022Fungis\u0022,\u0022ITCrowd\u0022,\u0022Mibis\u0022,\u0022hotOrNot\u0022,\u0022Ribos\u0022],\u0022y\u0022:[6,11,4,17,15],\u0022marker\u0022:{},\u0022name\u0022:\u0022BeerConsumption\u0022,\u0022showlegend\u0022:true,\u0022textposition\u0022:\u0022top right\u0022,\u0022xaxis\u0022:\u0022x2\u0022,\u0022yaxis\u0022:\u0022y2\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u0022Fungis\u0022,\u0022ITCrowd\u0022,\u0022Mibis\u0022,\u0022hotOrNot\u0022,\u0022Ribos\u0022],\u0022y\u0022:[2,20,1,5,4],\u0022marker\u0022:{},\u0022name\u0022:\u0022BeverageConsumption\u0022,\u0022xaxis\u0022:\u0022x3\u0022,\u0022yaxis\u0022:\u0022y3\u0022}];\n  var layout = {\u0022yaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [cups]\u0022,\u0022anchor\u0022:\u0022x\u0022,\u0022domain\u0022:[0.71666666666666667,1.0]},\u0022xaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [huelsen]\u0022,\u0022anchor\u0022:\u0022x2\u0022,\u0022domain\u0022:[0.38333333333333341,0.66666666666666674]},\u0022xaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y2\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis3\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [bottles]\u0022,\u0022anchor\u0022:\u0022x3\u0022,\u0022domain\u0022:[0.050000000000000044,0.33333333333333337]},\u0022xaxis3\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y3\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022width\u0022:1000.0,\u0022height\u0022:750.0};\n  Plotly.newPlot(\u00278b2201a7-8f55-4bf6-8fbf-5956967303bc\u0027, data, layout);\n\u003C/script\u003E\n\n### Population distribution\n\nThere seems to be only two types of coffee drinkers: Those that drink many cups, and those that drink a low amount of cups. A middle ground seems to be missing, but this could be due to the for us invisible amount of coffe from other machines that we can\u0027t register.\nThis seems not to be the case for the other types of drinks, where the decay from high to low consumption looks much more linear. Further clustering analysis could be used to further test this observation.  \n\n\u003Cdiv class=\u0022PlotlyChart\u0022 id=\u0022383d0f9c-c6a0-45b5-b52b-2e9901f13a55\u0022 style=\u0022width: 1000px; height: 750px;\u0022\u003E\u003C!-- Plotly chart will be drawn inside this DIV --\u003E\u003C/div\u003E        \n\u003Cscript\u003E\n  var data = [{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25],\u0022y\u0022:[32,30,27,25,25,23,21,9,9,7,7,7,6,6,5,4,4,3,3,2,2,2,2,1,1,1],\u0022marker\u0022:{},\u0022name\u0022:\u0022CoffeeConsumption\u0022,\u0022xaxis\u0022:\u0022x\u0022,\u0022yaxis\u0022:\u0022y\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[0,1,2,3,4,5,6,7,8,9,10,11,12],\u0022y\u0022:[8,7,7,7,5,4,4,3,3,2,1,1,1],\u0022marker\u0022:{},\u0022name\u0022:\u0022BeerConsumption\u0022,\u0022xaxis\u0022:\u0022x2\u0022,\u0022yaxis\u0022:\u0022y2\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],\u0022y\u0022:[5,5,3,3,3,3,2,2,1,1,1,1,1,1],\u0022marker\u0022:{},\u0022name\u0022:\u0022BeverageConsumption\u0022,\u0022xaxis\u0022:\u0022x3\u0022,\u0022yaxis\u0022:\u0022y3\u0022}];\n  var layout = {\u0022yaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [cups]\u0022,\u0022anchor\u0022:\u0022x\u0022,\u0022domain\u0022:[0.71666666666666667,1.0]},\u0022xaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [huelsen]\u0022,\u0022anchor\u0022:\u0022x2\u0022,\u0022domain\u0022:[0.38333333333333341,0.66666666666666674]},\u0022xaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y2\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis3\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Consumption [bottles]\u0022,\u0022anchor\u0022:\u0022x3\u0022,\u0022domain\u0022:[0.050000000000000044,0.33333333333333337]},\u0022xaxis3\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y3\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022width\u0022:1000.0,\u0022height\u0022:750.0};\n  Plotly.newPlot(\u0027383d0f9c-c6a0-45b5-b52b-2e9901f13a55\u0027, data, layout);\n\u003C/script\u003E\n\n## Distance stats\n\nFor this analysis, Venny and I chose the paths that we thought are most likely taken to walk to the coffee machine. If you feel like they are not adequate for your team, feel free to correct us.\n\n\u003Ccenter\u003E\u003Cimg src=\u0022../img/Distances.png\u0022 width=\u0022850px\u0022\u003E\u003C/center\u003E\n\nThe distances for a one way walk to the coffee machines for the teams then are:\n\n * Fungis   : 25.2m\n * hotOrNot : 29.5m\n * Mibis    : 36.5m\n * Ribos    : 38.5m\n * ITCrowd  : 47m\n\nTaking into account that most of the time, one also has to walk back after/to/while consuming the coffee, this distance is doubled for every walk.\nAs the team with the highest distance to the coffee machine is also the one with the highest coffee consumption, the ITCrowd team finishes at a total of almost 16(!) walked kilometers, only to get coffee.\nAs the distances and coffee consumption of the other teams are lower, the walked kilometers decrease drastically.  \n\n\u003Cdiv class=\u0022PlotlyChart\u0022 id=\u0022f1808472-82db-4f1e-b4ff-751fbea243f3\u0022 style=\u0022width: 1000px; height: 750px;\u0022\u003E\u003C!-- Plotly chart will be drawn inside this DIV --\u003E\u003C/div\u003E        \n\u003Cscript\u003E\n  var data = [{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u0022Fungis\u0022,\u0022ITCrowd\u0022,\u0022Mibis\u0022,\u0022hotOrNot\u0022,\u0022Ribos\u0022],\u0022y\u0022:[201.6,15886.0,5183.0,826.0,462.0],\u0022marker\u0022:{},\u0022name\u0022:\u0022total distance traveled\u0022,\u0022xaxis\u0022:\u0022x\u0022,\u0022yaxis\u0022:\u0022y\u0022},{\u0022type\u0022:\u0022bar\u0022,\u0022x\u0022:[\u0022Fungis\u0022,\u0022ITCrowd\u0022,\u0022Mibis\u0022,\u0022hotOrNot\u0022,\u0022Ribos\u0022],\u0022y\u0022:[201.6,1985.75,471.18181818181819,206.5,231.0],\u0022marker\u0022:{},\u0022name\u0022:\u0022mean distance traveled\u0022,\u0022error_y\u0022:{\u0022array\u0022:[\u0022NaN\u0022,981.3084195530547,489.00589325320368,140.44809242800938,217.78888860545663]},\u0022xaxis\u0022:\u0022x2\u0022,\u0022yaxis\u0022:\u0022y2\u0022}];\n  var layout = {\u0022yaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022Total distance traveled [m]\u0022,\u0022anchor\u0022:\u0022x\u0022,\u0022domain\u0022:[0.55,1.0]},\u0022xaxis\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022yaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022title\u0022:\u0022mean distance traveled [m/person]\u0022,\u0022anchor\u0022:\u0022x2\u0022,\u0022domain\u0022:[0.050000000000000044,0.5]},\u0022xaxis2\u0022:{\u0022tickmode\u0022:\u0022auto\u0022,\u0022ticks\u0022:\u0022inside\u0022,\u0022mirror\u0022:\u0022all\u0022,\u0022showline\u0022:true,\u0022showgrid\u0022:false,\u0022zeroline\u0022:false,\u0022titlefont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022tickfont\u0022:{\u0022family\u0022:\u0022Arial\u0022,\u0022size\u0022:15.0},\u0022anchor\u0022:\u0022y2\u0022,\u0022domain\u0022:[0.0,0.95]},\u0022width\u0022:1000.0,\u0022height\u0022:750.0};\n  Plotly.newPlot(\u0027f1808472-82db-4f1e-b4ff-751fbea243f3\u0027, data, layout);\n\u003C/script\u003E\n\n## Final remarks\nThe main conclusion that can be drawn from this analysis is that the coffee machine is mainly used by the people which already used it before the move (ITCrowd and Mibis).\nThe other teams mainly use the ticking system for either alcoholic or non alcoholic beverages, and are either no big coffee drinkers or still use their own coffee machines. \nHowever, if you think this effect is due to problems using the new system, feel free to send me an email with your questions about the ticking system.\n\nIf you have ideas of other ways to look at this data or are interested in the datasets yourself, you are also welcome to write me an email or discuss it with me directly.\n\nSo far this was fun. I will use these kinds of reports in the future to explore more ways of analyzing the datasets we get by the ticking system and will include them in future reports.\n\nSo long and happy ticking,\n\nKevin\n\n*)\n\n"},{"uri":"/CSBlog/posts/Community_detection_or_Principal_Component_Analysis_- Different_apporaches_to_analyze_big_datasets.html","title":"Community detection or Principal Component Analysis - Different apporaches to analyze big datasets","content":"(**\n\n---\ntitle: Community detection or Principal Component Analysis - Different apporaches to analyze big datasets\ncategory: Implementation\ncategoryindex: 3\nindex: 4\n---\n*)\n(***hide***)\n\n#r \u0022nuget: FSharp.Data, 4.2.7\u0022\n#r \u0022nuget: Deedle, 2.5.0\u0022\n#r \u0022nuget: Cyjs.NET, 0.0.4\u0022\n#r \u0022nuget: Plotly.NET, 2.0.0-preview.16\u0022\n#r \u0022nuget: FSharp.FGL, 0.0.2\u0022\n#r \u0022nuget: FSharp.FGL.ArrayAdjacencyGraph, 0.0.2\u0022\n#r \u0022nuget: BioFSharp, 2.0.0-beta7\u0022\n#r \u0022nuget: BioFSharp.Stats, 2.0.0-beta6\u0022\n#r \u0022nuget: FSharp.Stats, 0.4.3\u0022\n\nopen Deedle\nopen Plotly.NET\nopen Plotly.NET.StyleParam\nopen FSharp.Data\nopen FSharp.Stats\nopen FSharp.Stats.Testing\nopen Cyjs.NET\nopen FSharp.FGL.ArrayAdjacencyGraph\nopen ArrayAdjacencyGraph.Algorithms.Louvain.Louvain\nopen BioFSharp\nopen BioFSharp.Stats\n\n(**\n# Community detection or Principal Component Analysis - Different apporaches to analyze big datasets\n_[Christopher Lux](https://github.com/LibraChris)_, Jan 2022\n\n\n## Content\n- [Introduction](#Introduction)\n- [Loading the previous graph](#Loading-the-previous-graph)\n- [Modularity](#Modularity)\n- [PCA - Principal component analysis](#PCA-Principal-component-analysis)\n- [Ontology Enrichment](#Ontology-Enrichment)\n- [Further reading](#Further-reading)\n\n## Introduction\n\nThis tutorial picks up where the Fslab advanced tutorials [Correlation network](https://fslab.org/content/tutorials/009_correlation-network.html) ended.\n The goal of this blogpost is to showcase different methods to analyze big datasets:\nThe graph-Analysis apporach featuring community detection and ontology enrichment vs \nthe principal component analysis approach that reduces the dimensions of complex datasets.\n\nWe are using the following libraries:\n\n1. [Deedle](https://github.com/fslaborg/Deedle)\n2. [Plotly.NET](https://github.com/plotly/Plotly.NET/)\n3. [Cyjs.NET](https://github.com/fslaborg/Cyjs.NET)\n4. [BioFSharp](https://github.com/CSBiology/BioFSharp)\n5. [FSharp.Data](https://github.com/fsprojects/FSharp.Data)\n6. [FSharp.Stats](https://github.com/fslaborg/FSharp.Stats)\n7. [FSharp.FGL](https://github.com/CSBiology/FSharp.FGL)\n\n## Loading the previous graph \n\nWe start by recreating the graph depicted in [Correlation network](https://fslab.org/content/tutorials/009_correlation-network.html) .\nThe code for this is hidden since it is just the same as in the blogpost. \nIf you are interested in the creation of the correlation network you can read about it there.\n*)\n(***hide***)\n// Load the data \nlet rawData = Http.RequestString @\u0022https://raw.githubusercontent.com/HLWeil/datasets/main/data/ecoliGeneExpression.tsv\u0022\n\n// Create a deedle frame and index the rows with the values of the \u0022Key\u0022 column.\nlet rawFrame : Frame\u003Cstring,string\u003E = \n    Frame.ReadCsvString(rawData, separators = \u0022\\t\u0022)\n    |\u003E Frame.take 500\n    |\u003E Frame.indexRows \u0022Key\u0022\n\n// Get the rows as a matrix\nlet rows = \n    rawFrame \n    |\u003E Frame.toJaggedArray \n    |\u003E Matrix.ofJaggedArray\n\n// Create a correlation network by computing the pearson correlation between every two rows\nlet correlationNetwork = \n    Correlation.Matrix.rowWisePearson rows\n\nlet thr = 0.8203125\n\n// Set all correlations less strong than the critical threshold to 0\nlet filteredNetwork = \n    correlationNetwork\n    |\u003E Matrix.map (fun v -\u003E if (abs v) \u003E thr then v else 0.)\n\n// The styled vertices. The size is based on the degree of this vertex, so that more heavily connected nodes are emphasized\nlet cytoVertices = \n    rawFrame.RowKeys\n    |\u003E Seq.toList\n    |\u003E List.indexed\n    |\u003E List.choose (fun (i,v) -\u003E \n        let degree = \n            Matrix.getRow filteredNetwork i \n            |\u003E Seq.filter ((\u003C\u003E) 0.)\n            |\u003E Seq.length\n        let styling = [CyParam.label v; CyParam.weight (sqrt (float degree) \u002B 1. |\u003E (*) 10.)]\n\n        if degree \u003E 1 then \n            Some (Elements.node (string i) styling)\n        else \n            None\n    )\n\n// Styled edges\nlet cytoEdgesOG = \n    let len = filteredNetwork.Dimensions |\u003E fst\n    [\n        for i = 0 to len - 1 do\n            for j = i \u002B 1 to len - 1 do\n                let v = filteredNetwork.[i,j]\n                if v \u003C\u003E 0. then yield i,j,v\n    ]\n    |\u003E List.mapi (fun i (v1,v2,weight) -\u003E \n        let styling = [CyParam.weight (0.2 * weight)]\n        Elements.edge (\u0022e\u0022 \u002B string i) (string v1) (string v2) styling\n    )\n   \n// Resulting cytograph\nlet cytoGraph = \n\n    CyGraph.initEmpty ()\n    |\u003E CyGraph.withElements cytoVertices\n    |\u003E CyGraph.withElements cytoEdgesOG\n    |\u003E CyGraph.withStyle \u0022node\u0022 \n        [\n            CyParam.shape \u0022circle\u0022\n            CyParam.content =. CyParam.label\n            CyParam.width =. CyParam.weight\n            CyParam.height =. CyParam.weight\n            CyParam.Text.Align.center\n            CyParam.Border.color \u0022#A00975\u0022\n            CyParam.Border.width 3\n        ]\n    |\u003E CyGraph.withStyle \u0022edge\u0022 \n        [\n            CyParam.Line.color \u0022#3D1244\u0022\n        ]\n    |\u003E CyGraph.withLayout (Layout.initCose (Layout.LayoutOptions.Cose(NodeOverlap = 400,ComponentSpacing = 100)))  \n\n(**\n*)\n(***do-not-eval***)\ncytoGraph\n|\u003E CyGraph.withSize (1300,1000)\n|\u003E CyGraph.show\n(***hide***)\nSystem.IO.File.ReadAllText \u0022../files/ecoliGeneExpressionCyjs.html\u0022\n(*** include-it-raw ***)\n\n(**\nNow to recreate this graph in FSharp.FGl.ArrayAdjacencyGraph we simply have to create a vertex list and an edge list:\nOnce again we are using the data from [Correlation network](https://fslab.org/content/tutorials/009_correlation-network.html) .\n\n*)\n\n// Creates a vertex list based on the cytoVertices\nlet vertexList =\n    rawFrame.RowKeys\n    |\u003E Seq.toList\n    |\u003E List.indexed\n    |\u003E List.choose (fun (i,v) -\u003E \n        let degree = \n            Matrix.getRow filteredNetwork i \n            |\u003E Seq.filter ((\u003C\u003E) 0.)\n            |\u003E Seq.length\n        \n        if degree \u003E 1 then \n            Some (i,v)\n        else\n            None\n    )\n\n// Creates an edge list based on the cytoEdges\nlet edgeList =\n    let len = filteredNetwork.Dimensions |\u003E fst\n    [\n        for i = 0 to len - 1 do\n            for j = i \u002B 1 to len - 1 do\n                let v = filteredNetwork.[i,j]\n                if v \u003C\u003E 0. then yield i,j,v\n    ]\n\n// Creates an ArrayAdjacencyGraph based on vertexList and edgeList\nlet startingGraph = \n    Graph.createOfEdgelist vertexList edgeList\n\n(**\n\n## Modularity\n\nOne crucial factor in network science is the ability to represent large datasets in comprehensible graphs.\nBut when these graphs get to large, it is often very difficult to retrieve useful data from them without using some form of simplification.\nOne such method is the decomposition of networks into communities, sets of highly interconnected vertices.\nBy reducing the information of each of the vertices into these communities the size of the network can be reduced quite effectively.\nThe interdependence of the community-building vertices is often based on a functional module that the vertices belong to.\nAs such, the detection of communities is a really interesting factor in network science.\nThe Louvain-algorithm, published in [Blondel, Vincent D; Guillaume, Jean-Loup; Lambiotte, Renaud; Lefebvre, Etienne (9 October 2008). \u0022Fast unfolding of communities in large networks\u0022. Journal of Statistical Mechanics: Theory and Experiment. 2008 (10): P10008. arXiv:0803.0476. Bibcode:2008JSMTE..10..008B. doi:10.1088/1742-5468/2008/10/P10008. S2CID 334423](https://doi.org/10.1088%2F1742-5468%2F2008%2F10%2FP10008) ,\nis one of the possible algorithms for community detection and has been integrated into [FSharp.FGL](https://github.com/CSBiology/FSharp.FGL).\n\nHere we apply this algorithm on our existing graph:\n*)\n\n// The graph after being grouped into communities\nlet louvainGraph = \n    louvain startingGraph 0.1 \n\n\n(**\n\nThe Louvain algorithm reveals that the graph can be rationed into 34 communities. \nIn the following steps, we color the communities that feature more than 5 members using Cyjs.Net.\nThe code to create the Map which connected the community identifier and the color code has been omitted since it is not important for the rest of the data analysis.\n*)\n(***hide***)\n// Map that connected the community identifier with a color codex\nlet colorMap =\n    \n    // List of all communities that have more than 5 members\n    let communitiesToColorList = \n        Vertices.getLabelList louvainGraph\n        |\u003E Array.map (snd)\n        |\u003E Array.countBy (fun x -\u003E x)\n        |\u003E Array.choose(fun (m,count) -\u003E \n            if count \u003E 5 then\n                Some m\n            else\n                None\n            )\n        |\u003E List.ofArray\n\n    // List of hexadecimal colors. \n    [\n        \u0022#A00976\u0022;\n        \u0022#D68A0C\u0022;\n        \u0022#13478D\u0022;\n        \u0022#9ACB0B\u0022;\n        \u0022#C249A1\u0022;\n        \u0022#FFC360\u0022;\n        \u0022#4B74AD\u0022;\n        \u0022#CCF35C\u0022;\n        \u0022#640048\u0022;\n        \u0022#855300\u0022;\n        \u0022#052858\u0022;\n        \u0022#5E7F00\u0022;\n        \u0022#CC0000\u0022;\n        \u0022#FFC0CB\u0022\n\n    ]\n    |\u003E List.map2(fun community color -\u003E (community,color)) communitiesToColorList\n    |\u003E Map.ofList\n\n// Map that maps the gene name to the color it is associated with because of its community\nlet geneNameToColor =\n    \n    let louvainLabelToColor= \n        Vertices.getLabelList louvainGraph\n        |\u003E Array.countBy (fun (gene,x) -\u003E x)\n        |\u003E Array.choose(fun (m,count) -\u003E \n            if count \u003E 5 then\n                Some m\n            else\n                None\n            )\n        |\u003E Array.map(fun x -\u003E (x,colorMap.Item (x)))\n        |\u003E Map.ofArray\n\n    Vertices.getLabelList louvainGraph\n    |\u003E Array.map(fun (gene,label) -\u003E \n        (gene,\n            (if (Map.containsKey label louvainLabelToColor) then Map.find label louvainLabelToColor \n            else \u0022#808080\u0022))\n    )\n    |\u003E Map.ofArray\n\n// Table that showcases all communities, their member count and their connected color\nlet colorTable =\n    let header = [\u0022\u003Cb\u003ECommunity\u003C/b\u003E\u0022;\u0022Number of members\u0022;\u0022Color\u0022]\n    let rows = \n        Vertices.getLabelList louvainGraph\n        |\u003E Array.map (snd)\n        |\u003E Array.countBy (fun x -\u003E x)\n        |\u003E Array.sortByDescending (fun (community,count) -\u003E count)\n        |\u003E Array.map(fun (community,count) -\u003E [(sprintf \u0022%i\u0022 community);(sprintf \u0022%i\u0022 count);(if (Map.containsKey community colorMap) then (colorMap.Item community) else \u0022#808080\u0022)])\n    let cellColor =\n        Array.map(fun l -\u003E \n            let color = Color.fromString (List.last l)\n            [Color.fromString \u0022transparent\u0022;Color.fromString \u0022transparent\u0022;color]) rows\n        |\u003E Seq.transpose\n        |\u003E Seq.map Color.fromColors\n        |\u003E Color.fromColors\n    Chart.Table(\n        header,\n        rows,\n        HeaderOutlineColor = Color.fromString \u0022black\u0022,\n        CellsOutlineColor = Color.fromString \u0022black\u0022,\n        CellsOutlineWidth = 0.1,        \n        CellsFillColor = cellColor\n    )\n(**\n*)\n\n// The styled vertices. The color of the vertices is based on their community. The size is based on the degree of this vertex, so that more heavily connected nodes are emphasized.\nlet cytoVertices2 =\n    Array.map2 (fun v l -\u003E (v,l)) (louvainGraph.GetVertices()) (Vertices.getLabelList louvainGraph)\n    |\u003E List.ofArray\n    |\u003E List.map(fun (v,(l,c)) -\u003E\n        let styling = [CyParam.label l;if (Map.containsKey c colorMap) then CyParam.color (colorMap.Item (c));CyParam.weight (sqrt (float (Vertices.degree v louvainGraph)) \u002B 1. |\u003E (*) 10.)]\n        (Elements.node (string v) styling)\n\n    )\n\n// Creates an edge list based on the cytoEdges\nlet cytoEdges = \n    edgeList\n    |\u003E List.mapi (fun i (v1,v2,weight) -\u003E \n        let styling = [CyParam.weight (0.2 * weight)]\n        Elements.edge (\u0022e\u0022 \u002B string i) (string v1) (string v2) styling\n    )\n\n\n// Resulting cytograph\nlet cytoGraph2 = \n\n    CyGraph.initEmpty ()\n    |\u003E CyGraph.withElements cytoVertices2\n    |\u003E CyGraph.withElements cytoEdges\n    |\u003E CyGraph.withStyle \u0022node\u0022 \n        [\n            CyParam.shape \u0022circle\u0022\n            CyParam.content =. CyParam.label\n            CyParam.width =. CyParam.weight\n            CyParam.height =. CyParam.weight\n            CyParam.Text.Align.center\n            CyParam.Border.color =. CyParam.color\n            CyParam.Background.color =. CyParam.color\n        ]\n    |\u003E CyGraph.withStyle \u0022edge\u0022 \n        [\n            CyParam.Line.color \u0022#3D1244\u0022\n        ]\n    |\u003E CyGraph.withLayout (Layout.initCose (Layout.LayoutOptions.Cose(NodeOverlap = 400,ComponentSpacing = 100)))  \n\n(***do-not-eval***)\ncytoGraph2\n|\u003E CyGraph.withSize (1300,1000)\n|\u003E CyGraph.show\n\n(***hide***)\nSystem.IO.File.ReadAllText \u0022../files/ecoliGeneExpressionLouvainCyjs.html\u0022\n(*** include-it-raw ***)\n(***hide***)\nSystem.IO.File.ReadAllText \u0022../files/ecoliGeneExpressionColorTable.html\u0022\n(*** include-it-raw ***)\n\n(**\n*)\n(**\n## PCA - Principal component analysis\n\nAn entirely different approach to the graph analysis is given by the principal component analysis (PCA) . \nIt is most commonly used for dimensional reduction and to build predictive models.\nIn our case we reduce the dimensions of experiments from the data we used to create the first graph.\nMore accurately, the PCA reduces the dataset by highlighting its biggest variances.\nThe PCA algorithm can be found in [FSharp.Stats](https://fslab.org/FSharp.Stats/).\n*)\n\n// Calculations to get a PCA\nlet pcaData = \n    rows\n    |\u003E Matrix.transpose\n    |\u003E fun x -\u003E\n        let pcaComponents = ML.Unsupervised.PCA.compute (ML.Unsupervised.PCA.toAdjustCenter x) x\n\n        let pComponent1 = pcaComponents.[0]\n        let pComponent2 = pcaComponents.[1]\n        let x = pComponent1.EigenVector \n        let y = pComponent2.EigenVector \n        \n        let pcaCoordinates = Array.map2 (fun c1 c2 -\u003E (c1,c2)) x y\n        \n        pcaCoordinates\n\n(**\nUsing the calculated data, we color each gene based on its coloring in the Louvain-Graph to showcase the differences between the community detection and the PCA.\n*)\n\n// Creation of a pointchart based on the PCA data\nlet pcaChart = \n    let labelArray = rawFrame.RowKeys |\u003E Array.ofSeq\n\n    pcaData\n    |\u003E Array.mapi(fun i x -\u003E \n        (labelArray.[i]),Chart.Point(\n            [x],\n            Text=labelArray.[i],\n            MarkerColor=(\n                if (Map.containsKey (labelArray.[i]) geneNameToColor) then\n                    Color.fromHex(Map.find(labelArray.[i]) geneNameToColor)\n                else\n                    Color.fromString \u0022gray\u0022\n                    ))|\u003E Chart.withTraceName (labelArray.[i]))\n    |\u003E Array.choose(fun (l,chart) -\u003E if List.contains l (vertexList|\u003EList.map snd) then Some chart else None)\n    |\u003E Chart.combine\n    |\u003E Chart.withYAxisStyle(title=\u0022PC2\u0022)\n    |\u003E Chart.withXAxisStyle(title=\u0022PC1\u0022)\n\n(***do-not-eval***)\npcaChart\n|\u003E Chart.withSize(1300,1000)\n|\u003E Chart.show\n\n(***hide***)\nSystem.IO.File.ReadAllText \u0022../files/ecoliGeneExpressionPCA.html\u0022\n(***include-it-raw***)\n\n(**\nWhile some communities from the Louvain analysis can be spotted in the PCA chart on behalf of their clustering, most of them are widespread, a sign for a high variance in the original dataset.\nUsing a clustering algorithm would lead to a much different communities than the PCA revealed.\nA mathematical demonstration of this was deemed unnecessary, since most of the data points lie on top of another and would therefore be clustered together.\n\n## Ontology Enrichment\n\nOntology enrichment is a method to identify overrepresented transcript/protein groups in data sets. \nThe used annotation is based on the [AnnotationARC](https://github.com/CSBiology/ARCs/tree/main/AnnotationARC) .\nand the calculation is done via [BioFSharp.Stats](https://github.com/CSBiology/BioFSharp) .\nHere we try to find overrepresented protein functions in the Louvain communities to see if there is a functional modularity or\nif the communities are not that relevant, just like the PCA suggested. \n*)\n\n// Maps the gene name to its molecular function based on the AnnotationARC\nlet geneNameToMolecularFunction =\n    let d :Frame\u003Cstring,string\u003E=\n        Frame.ReadCsv(@\u0022../CSBlog/docs/files/ecoliGeneExpression.tsv\u0022,separators=\u0022\\t\u0022)\n        |\u003E Frame.take 500\n        |\u003E Frame.indexRows \u0022Key\u0022\n\n    let col :Series\u003Cstring,string\u003E=\n        Frame.getCol \u0022Gene ontology (molecular function)\u0022 d\n\n    Seq.map2 (fun name f -\u003E (name,f)) (col|\u003E Series.keys) (col|\u003E Series.values)\n    |\u003E Map.ofSeq\n\n// List of all the community identifiers we want to use for ontology enrichment\nlet moduleNumbers = [|0..34|]\n\n// Create the ontology terms on the gene data\nlet ontologyTerms =\n    Vertices.getLabelList louvainGraph\n    |\u003E Array.map(fun (name,community) -\u003E (name,[|1.223;2.123123|],community,(Map.find name geneNameToMolecularFunction)))\n    |\u003E Array.map (fun (name,data,modularityClass,annotation) -\u003E\n        let annotationProcessed = annotation.Replace (\u0022| \u0022,\u0022|\u0022)\n        OntologyEnrichment.createOntologyItem name annotationProcessed modularityClass data\n        |\u003E OntologyEnrichment.splitMultipleAnnotationsBy \u0027|\u0027 \n        )\n    |\u003E Seq.concat\n\n// Run the ontology enrichment on every enty in ontologyTerms\nlet gseaResult =\n    moduleNumbers\n    |\u003E Array.map (fun x -\u003E\n        x,OntologyEnrichment.CalcOverEnrichment x (Some 5) (Some 2) ontologyTerms\n        )\n\n// Return the enriched ontology entries \nlet ontologyResult = \n    gseaResult\n    |\u003E Array.map (fun (moduleNumber,moduleEnrichment) -\u003E\n        let pvalues = moduleEnrichment |\u003E Seq.map (fun x -\u003E x.PValue)\n        let pvaluesAdj = MultipleTesting.benjaminiHochbergFDR pvalues |\u003E Array.ofSeq\n        moduleEnrichment\n        |\u003E Seq.mapi (fun i x -\u003E x,pvaluesAdj.[i])\n        |\u003E Seq.filter (fun (item,pvalAdj) -\u003E item.PValue \u003C 0.05) \n        |\u003E Seq.sortByDescending (fun (item,pvalAdj) -\u003E item.NumberOfDEsInBin) \n        |\u003E Seq.map (fun (x,pvalAdj) -\u003E\n            //TotalUnivers was renamed to TotalUniverse\n            [sprintf \u0022%i\u0022 moduleNumber; x.OntologyTerm; sprintf \u0022%i\u0022 x.TotalUnivers; sprintf \u0022%i\u0022 x.TotalNumberOfDE; sprintf \u0022%i\u0022 x.NumberInBin;sprintf \u0022%i\u0022 x.NumberOfDEsInBin; sprintf \u0022%f\u0022x.PValue ;sprintf \u0022%f\u0022 pvalAdj]\n            \n            )\n        )\n    |\u003E Seq.choose(fun x -\u003E if Seq.isEmpty x then None else Some x)\n    |\u003E Seq.map (fun x -\u003E List.ofSeq x)\n    |\u003E List.ofSeq\n    |\u003E List.concat\n\n// Build a Plotly.Net table of the ontology enrichment     \nlet ontologyTable =\n    let header = [\u0022\u003Cb\u003ECommunity\u003C/b\u003E\u0022;\u0022OntologyTerm\u0022;\u0022TotalUniverse\u0022;\u0022TotalNumberOfDE\u0022;\u0022NumberInBin\u0022;\u0022NumberOfDEsInBin\u0022;\u0022PValue\u0022;\u0022pvalAdj\u0022]\n    let rows = \n        ontologyResult\n    Chart.Table(header, rows)\n\n\n(**\nThe result of the ontology enrichment can be seen in the following table. The headers are explained in the [BioFsharp doku](https://csbiology.github.io/BioFSharp//GSEA.html) .\n*)\n\n(***do-not-eval***)\nontologyTable\n|\u003E Chart.withSize(1300,1000)\n|\u003E Chart.show\n\n(***hide***)\nSystem.IO.File.ReadAllText \u0022../files/ecoliGeneExpressionOntologyTable.html\u0022\n(***include-it-raw***)\n\n\n\n(**\n\nFrom the table above I have chosen to show community 30 as an example of the differences between community detection and PCA.\n\n*)\n(***hide***)\nlet cytoVerticesOntology =\n    Array.map2 (fun v l -\u003E (v,l)) (louvainGraph.GetVertices()) (Vertices.getLabelList louvainGraph)\n    |\u003E List.ofArray\n    |\u003E List.map(fun (v,(l,c)) -\u003E\n        let styling = [CyParam.label l;if c=30 then CyParam.color (colorMap.Item (c));CyParam.weight (sqrt (float (louvainGraph.Degree v)) \u002B 1. |\u003E (*) 10.)]\n        (Elements.node (string v) styling)\n\n    )\nlet cytoGraphOntology = \n\n    CyGraph.initEmpty ()\n    |\u003E CyGraph.withElements cytoVerticesOntology\n    |\u003E CyGraph.withElements cytoEdges\n    |\u003E CyGraph.withStyle \u0022node\u0022 \n        [\n            CyParam.shape \u0022circle\u0022\n            CyParam.content =. CyParam.label\n            CyParam.width =. CyParam.weight\n            CyParam.height =. CyParam.weight\n            CyParam.Text.Align.center\n            CyParam.Border.color =. CyParam.color\n            CyParam.Background.color =. CyParam.color\n        ]\n    |\u003E CyGraph.withStyle \u0022edge\u0022 \n        [\n            CyParam.Line.color \u0022#3D1244\u0022\n        ]\n    |\u003E CyGraph.withLayout (Layout.initCose (Layout.LayoutOptions.Cose(NodeOverlap = 400,ComponentSpacing = 100)))  \n\n\n(***hide***)\ncytoGraphOntology\n|\u003E CyGraph.withSize (1300,1000)\n|\u003E Cyjs.NET.HTML.toCytoHTML\n(**\n\n![Community detection vs PCA](../img/communityVsPCA.jpg)\n\nWhile comparing community 30 with its PCA counterpart it becomes apparent \nthat this functional group would not have been detected based on clustering of the PCA.\nThis does not mean that the PCA is without its merits, but merely show that \nthe application of different approached to datasets can and will deliver different results.\nThe combination and comparison between different methods is an important step in data evaluation \nand should always be considered when thinking about your dataflow.\n\n## Further reading\n\n- [Blondel, Vincent D; Guillaume, Jean-Loup; Lambiotte, Renaud; Lefebvre, Etienne (9 October 2008). \u0022Fast unfolding of communities in large networks\u0022. Journal of Statistical Mechanics: Theory and Experiment. 2008 (10): P10008. arXiv:0803.0476. Bibcode:2008JSMTE..10..008B. doi:10.1088/1742-5468/2008/10/P10008. S2CID 334423](https://doi.org/10.1088%2F1742-5468%2F2008%2F10%2FP10008)\n- [Fslab](https://fslab.org)\n- [FSharp.FGL](https://github.com/CSBiology/FSharp.FGL)\n\n*)"},{"uri":"/CSBlog/posts/documentation.html","title":"Creating a Documentation","content":"(**\n\n---\ntitle: Creating a Documentation\ncategory: Documentation\ncategoryindex: 1\nindex: 0\n---\n\n*)\n\n(*** hide ***)\n\n#r \u0022nuget: Plotly.NET, 2.0.0-preview.16\u0022\nopen Plotly.NET\n\n(**\n# Creating a Documentation\n## Introduction\n\nThis documentation is aimed at people of the CSB team who want to document their stuff by using the FSharp.Formatting formatter. \nThere of course is an [in depth documentation of how to use FSharp.Formatting by the creators](http://fsprojects.github.io/FSharp.Formatting/). \nAlso there\u0027s a good overview of the different mark down commands on [wikipedia](https://de.wikipedia.org/wiki/Markdown). \nThose things can be very cryptical at the beginning though. \nTherefore with this tutorial I want to give a quick and structured introduction into this topic. \nFor further information check out the aforementioned websites.  \nThe basic structure is as follows:\n\n* [At the start I want to introduce you to the **ProjectScaffold**](documentation.html#PS)\n* [Afterwards I\u0027ll explain **how to get started** and where to find what](documentation.html#Basics)\n* [Then I\u0027ll give a little introduction on **how you should write the documentian** for your code](documentation.html#What)\n* [I also include a small overview over the **different features** you have with markdown language and the formatted F#](documentation.html#Legend)\n* [At the end I\u0027ll explain **how to test your documentation**](documentation.html#Testing)  \n\n\u003Ca name=\u0022PS\u0022\u003E\u003C/a\u003E\n## What is Project Scaffold?\n\nThe libraries of the CSBiology organization are built using the [ProjectScaffold](https://github.com/fsprojects/ProjectScaffold). In principle, this is a blueprint project to make creating and maintaining a F# project easier.\nBesides many other features, this includes automatic Documentation via the [FSharp.Formatting](https://github.com/fsprojects/FSharp.Formatting) formatter. \nThis formatter is called when one executes the **build.cmd** which is located in the project folder. Opening this build.cmd does not only compile the project, it also formats the \u003Cb\u003E.fsx\u003C/b\u003E(FSharp script file) documents to \u003Cb\u003E.html\u003C/b\u003E documents by using the FSharpFormatting formatter, besides other things. \nThe script files which are formatted have to be placed in \u0022..*project name*\\docsrc\\content\u0022. The formatted html files are then automatically placed in \u0022..*project name*\\docs\u0022. Keep in mind that by using the build.cmd, those files are built and stored only locally.\n\nNow that that\u0027s covered let\u0027s get to the important questions:\n*)\n(**\n\u003Ca name=\u0022Basics\u0022\u003E\u003C/a\u003E\n## Where to put what?\nLet\u0027s say you want to write a documentation about the topic \u0060topic\u0060\n\n* Place \u0060topic.fsx\u0060 in \u0022..*project name*\\docsrc\\content\u0022\n* Write the documentation in this \u0060topic.fsx\u0060 as follows\n\n   \u0060(*** hide ***)\u0060 in front of helpful library calls; Those won\u0027t be formatted.  \n   Put text into a comment as follows: \u0060(** text *)\u0060. This text will be formatted by markdown.  \n   Everything outside those brackets will be formatted as an F#-snippet  \n\n* In the \u0022..*project name*docsrc\\tools\\templates\\template.cshtml\u0022: Put a link to the html using the following line in the place you want your link to be created:\n\n   \u0060\u003Cli\u003E\u003Ca href=\u0022@Root/topic.html\u0022\u003ETopic\u003C/a\u003E\u003C/li\u003E\u0060\n   If you have some experience with HTML, how to do this comes quite naturally. If not, you can either do it via [Trial and Error](documentation.html#Testing) or even easier: just ask.\n\n* Commit your changes and create a pull request to the upstream repository. The added htmls will be included in the next release.\n\n\n\u003Ca name=\u0022What\u0022\u003E\u003C/a\u003E\n## What should I write about? \n\nGood question! But all good questions of course also have good answers (unfortunately not really). \nThe people who will read your tutorial are of course the ones who want to use your functions. So your task in the tutorial is basically to tell them \u003Cb\u003Ehow to use\u003C/b\u003E it, not necessarily how it works. \nThe core of your documentation therefore should be code snippets of the function being applied with real values, not snippets of the function definition:\n\n\u003Cb class=\u0022redText\u0022\u003E Bad Snippet: \u003C/b\u003E\n\u0022As you can see this function takes an int and a string and multiplies every letter in the string by using an enumerator...\u0022\n*)\n\nlet multiplyLetters (count:int) (word:string) = \n    let en = word.GetEnumerator()\n    let rec loop l =\n        match en.MoveNext() with\n        | true -\u003E loop (l @ List.init count (fun i -\u003E en.Current))\n        | false -\u003E l\n    loop []\n    |\u003E fun chars -\u003E new string [|for c in chars -\u003E c|]\n  \n(**\nShowing the definition will just result in the reader to lose a lot of time deciphering your code. The snippet should only show how to apply the function, so that the user can pick it up quick and apply it to his values. What the function does behind the screens should be explained separately.\n\n\u003Cb class=\u0022greenText\u0022\u003E Good Snippet: \u003C/b\u003E\n\u0022As you can see this function takes an int and a string and multiplies the number of every letter in the string by the int\u0022\n*)\n\nlet originalString = \u0022Hello!\u0022\nlet newString = multiplyLetters 5 originalString\n\n(**\nIn many cases the user will only look for the snippet because he already knows the algorithm but is not sure about how to use the implementation. \nOf course also delivering an explanation of the background of your implementation is highly advised. Especially when the algorithms used are not as trivial as the example above. For this you can give a short intro to the topic in general and even include \u003Ca href=\u0022@Root/Documentation.html#Links\u0022\u003Elinks\u003C/a\u003E.\n*)\n\n\n\n\n\n(**\n\u003Ca name=\u0022Legend\u0022\u003E\u003C/a\u003E\n## What are the features?\n\nAs already mentioned, there are already many lists for the standard mark down commands available. A quick google search yields:\n\n* [quick intro by wikipedia](https://de.wikipedia.org/wiki/Markdown)\n* [very in-depth list by adam-p](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)\n\nFor the matter of completion I\u0027ll still give a little overview on the different \u0060markdown-commands\u0060:  \n\n* [Headers](documentation.html#Headers) \n* Highlighting\n* [Links](documentation.html#Links) \n* [Images](documentation.html#Images) \n* [Lists](documentation.html#Lists) \n* [Escaping Markdown](documentation.html#[Escaping-Markdown) \n\nWhat\u0027s more important here though are the extra \u0060features of FSharp.Formatting\u0060, which are a bit hard to find otherwise:\n\n* Highlighting\n* [f# interactive output](documentation.html#ConsoleOutput) \n* [Plots by FSharp.Plotly](documentation.html#Plots)  \n\n\n### Headers\nFor headers, you can just put a number of \u0027#\u0027 at the start of the line, the header gets smaller, the more \u0027#\u0027 you use:  \n# One hashtag\n\u0060# One hashtag\u0060\n\n## Two hashtags\n\u0060## Two hashtags\u0060\n\n### Three hashtag\n\u0060### Three hashtags\u0060\n\n#### Four hashtags\n\u0060#### Four hashtags\u0060\n\n\u003Cbr\u003E\n\n### Links\nYou can easily link external websites or internal documents.\n\nThe basic command for this is\n\u003Cbr\u003E\n \u0060[text](link)\u0060\n\u003Cbr\u003E\nThe text you insert into the square brackets will be formatted to a clickable text. When you click it, the link will be opened. What you link to is your choice. You could for example link to external websites:  \n\u0060[Wikipedia](https://de.wikipedia.org/wiki/Wikipedia)\u0060 will be [Wikipedia](https://de.wikipedia.org/wiki/Wikipedia).  \nOn the other hand you can link local files:  \n\u0060[index](index.html)\u0060 will be [index](index.html)\n\n\n### Images\n\nImages are included similarly to normal links, but with a \u0060!\u0060 in front of them. So instead of \u0022\\[text](link)\u0022 you use  \n\u0060![image name](image link)\u0060  \nAgain you can link external images with a full url:  \n\u0060![Marshmallow](\\https://www.sammobile.com/wp-content/uploads/2015/12/android-marshmallow.jpg)\u0060 will be  \n\u003Cbr\u003E\n![Marshmallow](https://www.sammobile.com/wp-content/uploads/2015/12/android-marshmallow.jpg)\n\nOn the other hand you can link local files:  \n\u0060![logo](img/logo.png)\u0060 will be ![logo](img/logo.png) \nMake sure that the image you want to reference is located at \u0022..*project name*/docs/files/img\u0022. Also at the moment only **.png**s can be used for local referencing because only those are copied to the gh-pages in the building process.\n\n### Lists\n\nThere are unnumbered and numbered lists. For unnumbered lists, do a break and write consecutive lines with \u0060*\u0060 at the beginning. \nFor numbered lists, do the same but with numbers\u002Bdot instead.\nUnnumbered Lists:  \n\n\u0060* Entry1\u0060  \n\u0060* Entry2\u0060  \n\u0060* Entry3 also I include a piece of text so you get the idea of how the text will align when it reaches the end of the line.\u0060  \n\nwill be  \n\n* Entry1\n* Entry2\n* Entry3 also I include a piece of text so you get the idea of how the text will align when it reaches the end of the line.\n\nNumbered Lists:  \n\n\u00601. Entry1\u0060  \n\u00602. Entry2\u0060  \n\u00603. Entry3 also I include a piece of text so you get the idea of how the text will align when it reaches the end of the line.\u0060  \n\nwill be  \n\n1. Entry1\n2. Entry2\n3. Entry3 also I include a piece of text so you get the idea of how the text will align when it reaches the end of the line.  \n\nWhen you want to write **indented paragraphs** for one bullet point, \nafter writing the text which is supposed to stick to the bulletpoint, do: break, leave a line, tap space 3 times and write the text.  \n\u0060* Entry1\u0060  \n\u0060* Entry2 this is the text which sticks to this point, after this text I\u0027ll do the aforementioned things for an indented paragraph  \u0060  \n\u0060\u0060  \n\u0060   This is the next paragraph of this bulletpoint  \u0060  \n\u0060\u0060  \n\u0060* Entry3\u0060  \n\nwill be  \n\n* Entry1\n* Entry2 this is the text which sticks to this point, after this text I\u0027ll do the aforementioned things for an indented paragraph  \n\n   This is the next paragraph of this bulletpoint  \n\n* Entry3\n\n\n\n### Escaping Markdown\n\nSometimes you need to use characters for your documentation, which also are used by markdown. \nThis can lead to weird outcomes where characters are missing. \nTo circumvent this, you can use a \u0060\\\u0060 (backslash) infront of those characters.  \nE.g.:\n\n* \u0060There were two ** in the night sky\u0060 will be \u0060There were two in the night sky\u0060  \n* \u0060There were two \\*\\* in the night sky\u0060 will be \u0060There were two ** in the night sky\u0060\n\n\u003Ca name=\u0022ConsoleOutput\u0022\u003E\u003C/a\u003E\n### Console Output\nWith the FSharp.Formatting you can not only include stylized code snippets, but also include console output of the F# interactive. \n\nFor this, just put (\\*\\*\\* include-value:*ValueName* \\*\\*\\*\\) at the position in your document where you want your output to end up. The *ValueName* is the name to which a value has to be bound.\n\nE.g.:\n\u003Cpre\u003E\nlet whatAGreatName = 4 \u002B 5\n\n(\\*\\*\\* include-value:whatAGreatName \\*\\*\\*\\) \n\u003C/pre\u003E\nwill be\n\n*)\n\nlet whatAGreatName = 4 \u002B 5\n\n(*** include-value:whatAGreatName ***) \n\n(**\n\u003Ca name=\u0022Plots\u0022\u003E\u003C/a\u003E\n### Plots\nFor an in depth FSharp.Plotly tutorial, look [here](http://muehlhaus.github.io/FSharp.Plotly/).\n\nPlots can also be included via the same procedure:\n\u003Cpre\u003E\nlet myChart = Array.init 10 id |\u003E Array.indexed |\u003E Chart.Point\n\n(\\*\\*\\* include-value:myChart \\*\\*\\*\\) \n\u003C/pre\u003E\nwill be\n*)\n\nlet myChart = Array.init 10 id |\u003E Array.indexed |\u003E Chart.Point \n\n(*** include-value:myChart ***) \n\n(**\n\u003Ca name=\u0022Testing\u0022\u003E\u003C/a\u003E\n## How can I test my formatted documentation?\nYou can play around with the markdown text in an online tool like [dillinger.io](http://dillinger.io/).  \nThis is not really helpful though, if you want to test how the formattet site will look like on the project website. [As stated above](documentation.html#How), the build.cmd will create the \u0060htmls\u0060s of the \u0060fsx\u0060s which are located at \u0022..*project name*\\docsrc\\content\u0022 and automatically put them into \u0022..*project name*\\docs\u0022 together with all other needed files.\nYou can access the htmls there after building, but the references to the css styling files and all other ressources won\u0027t work. Therefore you will get a very plain looking, unstyled website.  \nTo bring everything in good form. A new buildtarget \u0022**releaseLocal**\u0022 was included in the CSB-projects. To access this target:\n\n### With VS2017\n\n* you have to **open your windows command prompt**\n* afterwards **navigate to the repository** \n\n   e.g. \u0060cd C:\\Users\\*ExampleUser*\\Source\\Repos\\*project name*\u0060\n\n* run \u0022**build -t releaselocal**\u0022\n\n   Besides compiling the repository, this will create the html files and copy everything from \u0022..*project name*\\docs\u0022 to \u0022..*project name*\\temp\\localDocs\u0022. \n\nWhen this is done, you can just open the \u0022temp/localDocs\u0022 folder and browse the htmls in a stylized form.\n\n*)"},{"uri":"/CSBlog/posts/WorkshopSeries_3_plotly.html","title":"Introduction to Data visualization using Plotly.NET","content":"(**\n\n---\ntitle: Introduction to Data visualization using Plotly.NET\ncategory: Visualization\ncategoryindex: 2\nindex: 0\n---\n\n*)\n\n(***hide***)\n#r \u0022nuget: Plotly.NET, 2.0.0-preview.16\u0022\n#r \u0022nuget: FSharpAux, 1.0.0\u0022\n\nopen Plotly.NET\nopen FSharpAux\n\nlet xSin = [0. .. 0.01 .. (4. * System.Math.PI)]\nlet ySin = xSin |\u003E List.map sin\nlet sinChart = \n    Chart.Spline(xSin,ySin)\n    |\u003E Chart.withTitle(\u0022sin(x)\u0022)\n    |\u003E Chart.withX_AxisStyle(\u0022x\u0022,ShowGrid=false,ShowLine=true)\n    |\u003E Chart.withY_AxisStyle(\u0022y\u0022,ShowGrid=false,ShowLine=true)\n\n#nowarn \u00220044\u0022\n\n(**\n![HeaderPicture](../img/Plotly_HeadPic.png)\n\n# Introduction to Data visualization using Plotly.NET\n_[Kevin Schneider](https://github.com/kMutagene)_\n\n## Table of contents \n * [Plotly.js](#Plotly.js)\n * [FSharp.Plotly](#FSharp.Plotly)\n * [Chart functions](#Chart functions)\n * [Rendering Charts](#Rendering Charts)\n * [Styling your Charts](#Styling your Charts)\n * [Multicharts](#Multicharts)\n\nIn the scope of this post, I will shortly introduce Plotly.js and our .NET counterpart Plotly.NET.\nI will go over the basic workflow to generate charts from data and how to style and combine charts.\n\n\u003C/br\u003E\n\n## Plotly.js\n\n[Plotly.js](https://plot.ly/javascript/) is an open source charting library written in javascript.\n\n![Plotly.js](../img/Plotly_1.png)\n\nVarious chart types are supported. From simple scatter and line plots over heatmaps and various 3D-plots to Map charts, \nyou will find something fitting your needs for visualization. \n\nOne of the coolest things about these charts is that all of them are interactive, as you can see in the example below. You can Zoom in and out,\nresize and move the axis, and much more.\n*)\n\n(***hide***)\nsinChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\nPlotly does not only generate your charts. It provides a service to change style and data of your chart after generation, which is called the chart studio.\n\u00DDou can access the chart studio by clicking on the \u0027edit in chart studio\u0027 icon above the chart.\n\n\u003C/br\u003E\n\n## FSharp.Plotly\n\n[FSharp.Plotly](https://github.com/muehlhaus/FSharp.Plotly) is a FSharp wrapper for Plotly.js. The library provides a complete mapping for the configuration options of \nthe underlying library but empowers you to use multiple programming styles (object oriented, functional, mixtures). So you get a nice F# interface support with the full power of Plotly.\n\n\u003C/br\u003E\n\n## Chart functions\n\nIn general, the Chart functions are a mapping from any kind of data to a GenericChart type:\n\n![chart functions](../img/ChartFunctions.png)\n\nAll chart functions (Point,Line,Heatmap,etc.) are provided as static methods of the \u0060Chart\u0060 Class. All of them take the input data and map\nto a \u0060GenericChart\u0060 type. Creating a chart can be as easy as this:\n*)\n\nopen Plotly.NET\n\n//Create some example data\n\n/// x values ranging from 0 to 4 \u03C0\nlet xVals = [0. .. 0.01 .. (4. * System.Math.PI)]\n/// Cosine values from 0 to 4 \u03C0\nlet yVals = xVals |\u003E List.map cos\n\n///GenericChart containing an X/Y scatter plot of the values above\nlet cosChart = Chart.Point(xVals,yVals)\n\n(**\n\n\u003C/br\u003E\n\n## Rendering Charts\n\nAll cool and good, but how to actually render a chart? This is pretty easy. We simply use the \u0060Chart.Show\u0060 function, which can take any\n\u0060GenericChart\u0060, generate the respective html file, and display it in your default browser.\n\nIn general, the Chart.Show function maps from the GenericChart type to unit, and rendering the html file as a side effect:\n\n![Chart.Show](../img/ChartShow.png)\n\n\n*)\n(***do-not-eval***)\n//Render the chart from the example above in your browser\ncosChart\n|\u003E Chart.show\n(**\n\nThis will display the following chart in your browser:\n\n*)\n\n(***hide***)\ncosChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\n\u003C/br\u003E\n\n## Styling your Charts\n\nI don\u0027t know about you, but I think this chart could look a little bit better.\n\nStyling charts with FSharp.Plotly can be done in multiple ways. We can use the optional parameters when initializing a chart:\n\n*)\n\nopen FSharpAux.Colors\n\nlet cosChart2 = \n    Chart.Point\n        (\n            xVals,\n            yVals,\n            MarkerSymbol = StyleParam.MarkerSymbol.Square,\n            MarkerColor = Color.fromKeyword LightGreen\n        )\n\n(***hide***)\ncosChart2 |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(** \nOr use a more functional style and pipe our chart into styling functions, which have even more control:\nWe first apply a similar styling as in the example above, but then additionally take control over the axis stylings (title,line style, and grid display):\n*)\n\nlet sinChart2 =\n    Chart.Point(xVals,yVals)\n    |\u003E Chart.withMarkerStyle(Size = 1, Color = Color.fromKeyword LightGreen, Symbol = StyleParam.MarkerSymbol.Square)\n    |\u003E Chart.withTitle(\u0022sin(x)\u0022)\n    |\u003E Chart.withXAxisStyle(\u0022x\u0022, ShowLine = true, ShowGrid = false, MinMax = (0.,(4.* System.Math.PI)))\n    |\u003E Chart.withYAxisStyle(\u0022y\u0022, ShowLine = true, ShowGrid = false)\n\n(***hide***)\nsinChart2 |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\nI am a fan of mirrored axis. There is no option to do that in \u0060Chart.withX_AxisStyle\u0060.\nTo have even more control over the Axis, we can initialize custom axis. This has to be implemented as a \nfunction because of the axis object may be mutated by styling functions when used in different charts. \nWe can prevent this by using a function that for every chart returns a new Axis.\n*)\nopen Plotly.NET.LayoutObjects\n\nlet myXAxis () = \n    LinearAxis.init(\n        Title   = Title.init(\u0022x\u0022),\n        ShowGrid= false,\n        ShowLine= true,\n        Mirror  = StyleParam.Mirror.All,\n        Range   = StyleParam.Range.MinMax (0.,(4. * System.Math.PI)),\n        TickMode = StyleParam.TickMode.Array,\n        TickVals = ([|0. .. (0.5 * System.Math.PI) .. (4. * System.Math.PI)|] |\u003E Array.map (round 2)),\n        Ticks   = StyleParam.TickOptions.Inside\n        )\n\nlet myYAxis () = \n    LinearAxis.init(\n        Title   = Title.init(\u0022y\u0022),\n        ShowGrid= false,\n        ShowLine= true,\n        Mirror  = StyleParam.Mirror.AllTicks,\n        Range   = StyleParam.Range.MinMax (-1.,1.),\n        TickMode = StyleParam.TickMode.Auto,\n        Ticks   = StyleParam.TickOptions.Inside\n        )\n\nlet mirroredSinChart =\n    Chart.Point(xVals,yVals)\n    |\u003E Chart.withMarkerStyle(Size = 1, Color = Color.fromKeyword DarkBlue, Symbol = StyleParam.MarkerSymbol.Square)\n    |\u003E Chart.withTitle(\u0022sin(x)\u0022)\n    |\u003E Chart.withXAxis(myXAxis())\n    |\u003E Chart.withYAxis(myYAxis())\n    |\u003E Chart.withSize(750.,750.)\n\n(***hide***)\nmirroredSinChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\n\u003C/br\u003E\n\n## Multicharts\n\nTo leverage the full power of data visualization, we often want to display multiple data series in the same plot. There are basically\ntwo options: Combining charts in a single plot or displaying them side-by-side in a stacked chart. Both functions map from a GenericChart collection to a single GenericChart:\n\n![MultiCharts](../img/MultiCharts.png)\n\n### Combining charts\n\nThe \u0060Chart.combine\u0060 function creates a single plot with the same axis from a collection of charts:\n\n*)\n\nlet combinedChart = \n    [\n        Chart.Spline(xVals,xVals |\u003E List.map sin, Name=\u0022sin(x)\u0022)\n\n        Chart.Spline(xVals,xVals |\u003E List.map cos,Name=\u0022cos(x)\u0022)\n    ]\n    |\u003E Chart.combine\n    |\u003E Chart.withTitle(\u0022sin(x) and cos(x)\u0022)\n    |\u003E Chart.withXAxis(myXAxis())\n    |\u003E Chart.withYAxis(myYAxis())\n    |\u003E Chart.withSize(750.,750.)\n\n(***hide***)\ncombinedChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)\n\n(**\n\u003C/br\u003E\n\n### Stacking charts\n\nThe \u0060Chart.Stack\u0060 function creates a multichart with the contents in a given collection of charts.\nAll subplots keep their own axis.\n\n*)\n\nlet stackedChart = \n    [\n        Chart.Spline(xVals,xVals |\u003E List.map sin)\n        |\u003E Chart.withTraceName(Name = \u0022sin(x)\u0022)\n        |\u003E Chart.withYAxis(myYAxis())\n        |\u003E Chart.withXAxis(myXAxis())\n\n        Chart.Spline(xVals,xVals |\u003E List.map cos)\n        |\u003E Chart.withTraceName(Name = \u0022sin(x)\u0022)\n        |\u003E Chart.withYAxis(myYAxis())\n        |\u003E Chart.withXAxis(myXAxis())\n    ]\n    |\u003E Chart.SingleStack()\n\n(***hide***)\nstackedChart |\u003E GenericChart.toChartHTML\n(***include-it-raw***)"}]